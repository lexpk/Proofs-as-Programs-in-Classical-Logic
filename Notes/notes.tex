\documentclass[onehalfspacing]{article}

\usepackage{amsmath,amssymb,amsthm}
\usepackage{ wasysym }
\usepackage{ stmaryrd }
\usepackage{ mathpartir }
\usepackage{xcolor}
\usepackage{bussproofs}
\usepackage[left=2.00cm, right=2.00cm, top=2.00cm,bottom=2.0cm]{geometry}
\usepackage{pdflscape}



\newtheorem{theorem}{Theorem}[section]
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{example}[theorem]{Example}

\newcommand{\llb}{\llbracket}
\newcommand{\rrb}{\rrbracket}
\newcommand{\blue}[1]{{\color{blue}#1}}
\newcommand{\var}{\text{var}}


\author{Alexander Pluska}
\title{Proofs as Programs in Classical Logic\\Notes}

\begin{document}

\maketitle

\section{Plan}

Goal:
\begin{itemize}
	\item Extract program from resolution proofs of $\forall\exists$-sentences over inductive datatypes.
\end{itemize}

\noindent Steps:

\begin{itemize}
	\item Give extensions of G\"odel's System \textbf{T} and HAS + EM$_1$ + SK$_1$ to arbitrary inductive datatypes (possibly GADTs) and prove (or rather check) properties, i.e. strong normalization, cut-elimination, uniqueness of normal forms.
	\item Adapt the results of~\cite{aschieri2014interactive} to exhibit realizers in $\mathcal{F} + \Phi$ for cut-free proofs in the extended version of HAS + EM$_1$ + SK$_1$ of formulas $\forall x\exists y Pxy$ where $P$ is a predicate in the extended version of \textbf{T}.
	\item Adapt the iterative learning from~\cite{aschieri2014interactive} to extract $\lambda$-terms from realizers.
	\item Give a proof translation from resolution proofs to cut-free sequent calculus proofs (already done?).
\end{itemize}

\noindent Questions:
\begin{itemize}
	\item When does the translated proof require more than EM$_1$?
	\item Using the methods in~\cite{aschieri2014interactive} the extracted term will be in simple $\lambda$-calculus. Is is possible to obtain a term in $\mathcal{F}$? (Talk with Federico Aschieri)
	\item Can the predicates be defined in $\mathcal{F}$ instead of $\mathcal{T}$? (probably yes)
	\item What happens if we add non-inductive theories?
	
\end{itemize}

\pagebreak

\pagebreak

To explain our approach let us first recall how resolution works and why it is effective for classical logic. In a nutshell the principle of resolution works as follows: From a set of formulas $A, B, C\dots$ obtain a set of sequents $A'_1\dots  A'_n\vdash A_1\dots A_n$, $B'_1\dots B'_n\vdash B_1\dots B_n$, $C'_1\dots C'_n\vdash C_1\dots C_n$ in which all occurring formulas are somehow simple. Then iteratively apply the resolution rule (and some other rules, but this is the crucial one), which is an analogon to cut, i.e.
\begin{center}
	\AxiomC{$A, \Gamma\vdash \Delta$}
	\AxiomC{$\Gamma'\vdash A', \Delta'$}
	\BinaryInfC{$(\Gamma\cup \Gamma')\theta\vdash (\Delta\cup\Delta')\theta$}
	\DisplayProof
\end{center}
where $\theta$ is the mgu of $A$ and $A'$, and by process of saturation (attempt to) obtain the empty Sequent.

Now for classical logic we can simply interpret $A'_1,\dots  A'_n\vdash A_1,\dots, A_n$ as $\neg A'_1\vee\dots\vee\neg A'_n\vee A_1\vee\dots\vee A_n$. Furthermore we can normalize every formula such that each of the $A'_i, A_i$ is atomic. The resolution calculus is then immediately refutationally complete, i.e. if $A, B, C\dots $ are inconsistent there exists a successful resolution, giving a refutation of $A\wedge B\wedge C\dots$, which is classically equivalent to a proof of $B\wedge C\dots\rightarrow\neg A$. I.e. if we want to prove $B\wedge C\dots\rightarrow A$ we can simply preform resolution on $\neg A\wedge B\wedge C\dots$

Now there are a number of hurdles in applying this strategy to intuitionistic logic, or to extract intuitionistic proof from classical resolution proofs. First and foremost is the non-existence of normal forms. In particular with the (intuitionally speaking) strict interpretation of $A'_1,\dots  A'_n\vdash A_1,\dots, A_n$ as $\neg A'_1\vee\dots\vee\neg A'_n\vee A_1\vee\dots\vee A_n$ we can hardly translate any formulas into such a form where the $A_i$ are atomic, or even literals. This can be remedied of course by interpreting $A'_1,\dots  A'_n\vdash A_1,\dots, A_n$ as $\neg(A'_1\wedge\dots\wedge A'_n\wedge(\neg A_1\vee\dots\vee \neg A_n))$, i.e. a double negation translation. But this brings us to the second problem: Even if our calculus is refutationally complete a refutation of $\neg A\wedge B\wedge C\dots$ does not give us a proof of $B\wedge C\dots\to A$ but rather $B\wedge C\dots\to \neg\neg A$. This problem is especially pronounced in the second interpretation of $\vdash$ where we are not even using $A$ but $\neg \neg A$.

Now there are a few saving graces: First of all, if $A$ is decidable, i.e. $\neg\neg A\to A$, we immediately obtain a proof of $A$. Furthermore we may attempt Friedman Translation~\cite{Friedman_1978} of our proof and indeed~\cite{Berger_2002} gives us some quite liberal criteria when this is possible in principle, e.g. when $B, C\dots$ are theorems of PA and $A$ is a $\Pi_0^2$ formula. And indeed interpreting $A'_1,\dots  A'_n\vdash A_1,\dots, A_n$ as $A'_1\to\dots\to A'_n\to A_1\vee\dots\vee A_n$, we are able to obtain an intuitionistic proof if their conditions are met and the input formulas can be transformed to such normal forms.

\section{Extracting constructive content from resolution proofs}
\subsection{The superposition calculus}
First let us define the calculus from which we wish to extract programs. It will comprise a core set of rules used in the vampire theorem prover taken from~\cite{Kov_cs_2013}. Note that we pay special attention to the usually neglected (and highly non-constructive) part of CNF transformation and Skolemization. Also note that we neglect the simplification ordering which is necessary to formulate a strategy for proof search but not for our proof transformation.

\noindent\textbf{Resolution.}
\begin{center}
\AxiomC{$A\vee B$}
\AxiomC{$\neg A'\vee C$}
\BinaryInfC{$(B\vee C)\theta$}
\DisplayProof
\end{center}
where $\theta$ is an mgu of $A$ and $A'$.

\noindent\textbf{Factoring.}
\begin{center}
	\AxiomC{$A\vee A'\vee B$}
	\UnaryInfC{$(A\vee B)\theta$}
	\DisplayProof
\end{center}
where $\theta$ is an mgu of $A$ and $A'$.

\noindent\textbf{Superposition.}
\begin{center}
	\AxiomC{$l=r\vee B$}
	\AxiomC{$L[s]\vee C$}
	\BinaryInfC{$(L[r]\vee B\vee C)\theta$}
	\DisplayProof
	\AxiomC{$l=r\vee B$}
	\AxiomC{$t[s] = t'\vee C$}
	\BinaryInfC{$(t[r] = t'\vee B\vee C)\theta$}
	\DisplayProof
	\AxiomC{$l=r\vee B$}
	\AxiomC{$t[s]\neq t'\vee C$}
	\BinaryInfC{$(t[r]\neq t'\vee B\vee C)\theta$}
	\DisplayProof
\end{center}
where $\theta$ is an mgu of $l$ and $s$, $s$ is not a variable, $L[s]$ is not an equality literal.

\noindent\textbf{Equality Resolution.}
\begin{center}
	\AxiomC{$s\neq t\vee C$}
	\UnaryInfC{$C\theta$}
	\DisplayProof
\end{center}
where $\theta$ is an mgu of $s$ and $t$.

\noindent\textbf{Equality Factoring.}
\begin{center}
	\AxiomC{$s=t\vee s'=t'\vee C$}
	\UnaryInfC{$(s=t\vee t\neq t'\vee C)\theta$}
	\DisplayProof
\end{center}
where $\theta$ is an mgu of $s$ and $s'$.

First let us look at an example of the transformation we going to do. We shall look at a proof of $\forall x\exists y: f(y) = g(x)$ from $\forall x: f(x) = g(h(x))$ and $\forall x: h(h'(x)) = x$. The program we extract hopefully is $h'$.

\begin{align}
	[\text{axiom}]&&\forall x: f(x) = g(h(x))\\
	[\text{cnf 1}]&&f(x_0) = g(h(x_0))\\
	[\text{axiom}]&&\forall x: h(h'(x)) = x\\
	[\text{cnf 3}]&&h(h'(x_0)) = x_0\\
	[\text{negated conjecture}]&&\neg\forall x\exists y: f(y) = g(x)\\
	[\text{ennf 5}]&&\exists x\forall y: f(y)\neq g(x)\\
	[\text{choice axiom}]&&\exists x\forall y: f(y)\neq g(x)\rightarrow \forall x : f(x) \neq g(s_0)\\
	[\text{skolemization 6, 7}]&&\forall x: f(x)\neq g(s_0)\\
	[\text{cnf 8}]&&f(x_1)\neq g(s_0)\\
	[\text{superposition 9, 2}]&\{\}&g(s_0)\neq g(h(x_0))\\
	[\text{superposition 10, 4}]&\{x_0\mapsto h'(x_0)\}&g(x_0)\neq g(s_0)\\
	[\text{equality resolution 11}]&&\bot
\end{align}

We first use the well known trick of adding the original conjecture to the negated one from~\cite{Luckham_1971} to transform this into a classical proof of $\forall x\exists y: f(x) = g(y)$ rather than a refutation of its negation:
\setcounter{equation}{0}
\begin{align}
	[\text{axiom}]&&\forall x: f(x) = g(h(x))\\
	[\text{cnf 1}]&&f(x_0) = g(h(x_0))\\
	[\text{axiom}]&&\forall x: h(h'(x)) = x\\
	[\text{cnf 3}]&&h(h'(x_0)) = x_0\\
	[\text{\color{red}{tautology}}]&&\forall x\exists y: f(y) = g(x)\vee\neg\forall x\exists y: f(y) = g(x)\\
	[\text{ennf 5}]&&\forall x\exists y: f(y) = g(x)\vee\exists x\forall y: f(y)\neq g(x)\\
	[\text{choice axiom}]&&\exists x\forall y: f(y)\neq g(x)\rightarrow \forall x : f(x) \neq g(s_0)\\
	[\text{choice axiom}]&&\forall x(\exists y: f(y)= g(x)\rightarrow f(s_1(x)) = g(x))\\
	[\text{skolemization 6, 7}]&&\forall x\exists y: f(y) = g(x)\vee\forall x: f(x)\neq g(s_0)\\
	[\text{skolemization 9, 8}]&&\forall x: f(s_1(x)) = g(x)\vee\forall x: f(x)\neq g(s_0)\\
	[\text{cnf 8}]&&f(s_1(x_1)) = g(x_1)\vee f(x_0)\neq g(s_0)\\
	[\text{superposition 11, 2}]&\{\}&f(s_1(x_1)) = g(x_1)\vee g(s_0)\neq g(h(x_0))\\
	[\text{superposition 12, 4}]&\{x_0\mapsto h'(x_0)\}&f(s_1(x_1)) = g(x_1)\vee g(x_0)\neq g(s_0)\\
	[\text{equality resolution 13}]&\{x_0\to s_0\}&f(s_1(x_1)) = g(x_1)
\end{align}

Next we eliminate free variables by propagating substitutions:

\setcounter{equation}{0}
\begin{align}
	[\text{axiom}]&&\forall x: f(x) = g(h(x))\\
	[\text{cnf 1}]&&f(h'(x_0)) = g(h(h'(x_0)))\\
	[\text{axiom}]&&\forall x: h(h'(x)) = x\\
	[\text{cnf 3}]&&h(h'(x_0)) = x_0\\
	[\text{tautology}]&&\forall x\exists y: f(y) = g(x)\vee\neg\forall x\exists y: f(y) = g(x)\\
	[\text{ennf 5}]&&\forall x\exists y: f(y) = g(x)\vee\exists x\forall y: f(y)\neq g(x)\\
	[\text{choice axiom}]&&\exists x\forall y: f(y)\neq g(x)\rightarrow \forall x : f(x) \neq g(s_0)\\
	[\text{choice axiom}]&&\forall x(\exists y: f(y)= g(x)\rightarrow f(s_1(x)) = g(x))\\
	[\text{skolemization 6, 7}]&&\forall x\exists y: f(y) = g(x)\vee\forall x: f(x)\neq g(s_0)\\
	[\text{skolemization 9, 8}]&&\forall x: f(s_1(x)) = g(x)\vee\forall x: f(x)\neq g(s_0)\\
	[\text{cnf 8}]&&f(s_1(x_1)) = g(x_1)\vee f(h'(x_0))\neq g(s_0)\\
	[\text{superposition 11, 2}]&\{\}&f(s_1(x_1)) = g(x_1)\vee g(s_0)\neq g(h(h'(x_0)))\\
	[\text{superposition 12, 4}]&\{\}&f(s_1(x_1)) = g(x_1)\vee g(x_0)\neq g(s_0)\\
	[\text{equality resolution 13}]&\{x_0\to s_0\}&f(s_1(x_1)) = g(x_1)
\end{align}


\setcounter{equation}{0}
\begin{align}
	[\text{axiom}]&&\forall x: f(x) = g(h(x))\\
	[\text{cnf 1}]&&f(h'(s_0)) = g(h(h'(s_0)))\\
	[\text{axiom}]&&\forall x: h(h'(x)) = x\\
	[\text{cnf 3}]&&h(h'(s_0)) = s_0\\
	[\text{tautology}]&&\forall x\exists y: f(y) = g(x)\vee\neg\forall x\exists y: f(y) = g(x)\\
	[\text{ennf 5}]&&\forall x\exists y: f(y) = g(x)\vee\exists x\forall y: f(y)\neq g(x)\\
	[\text{choice axiom}]&&\exists x\forall y: f(y)\neq g(x)\rightarrow \forall x : f(x) \neq g(s_0)\\
	[\text{choice axiom}]&&\forall x(\exists y: f(y)= g(x)\rightarrow f(s_1(x)) = g(x))\\
	[\text{skolemization 6, 7}]&&\forall x\exists y: f(y) = g(x)\vee\forall x: f(x)\neq g(s_0)\\
	[\text{skolemization 9, 8}]&&\forall x: f(s_1(x)) = g(x)\vee\forall x: f(x)\neq g(s_0)\\
	[\text{cnf 8}]&&f(s_1(x_1)) = g(x_1)\vee f(h'(s_0))\neq g(s_0)\\
	[\text{superposition 11, 2}]&\{\}&f(s_1(x_1)) = g(x_1)\vee g(s_0)\neq g(h(h'(s_0)))\\
	[\text{superposition 12, 4}]&\{\}&f(s_1(x_1)) = g(x_1)\vee g(s_0)\neq g(s_0)\\
	[\text{equality resolution 13}]&\{\}&f(s_1(x_1)) = g(x_1)
\end{align}

Next we remove all the skolem constants in the conjecture-tautology by unification, propagate this change, and finally reinterpet superposition as composition to yield a valid intuitionistic proof:

\setcounter{equation}{0}
\begin{align}
	[\text{axiom}]&&\forall x: f(x) = g(h(x))\\
	[\text{instantiation 1}]&&f(h'(x_1)) = g(h(h'(x_1)))\\
	[\text{axiom}]&&\forall x: h(h'(x)) = x\\
	[\text{instantiation 3}]&&h(h'(x_1)) = x_1\\
	[\text{tautology}]&&f(h'(x_1)) = g(x_1)\Rightarrow f(h'(x_1)) = g(x_1)\\
	[\text{equality 5, 2}]&\{\}&g(x_1)= g(h(h'(x_1)))\Rightarrow f(h'(x_1)) = g(x_1)\\
	[\text{equality 6, 4}]&\{\}&g(x_1)= g(x_1)\Rightarrow f(h'(x_1)) = g(x_1)\\
	[\text{equality 13}]&\{\}&f(h'(x_1)) = g(x_1)
\end{align}

Let us look at a second example: Consider the sentences $\forall x : p(x_0, f(x_0))$, $\forall x_0, x_1: (p(x_0, x_1)\Rightarrow q(x_0, g(x_1))$, $\forall x_0, x_1: (q(x_0, x_1)\Rightarrow r(x_0, h(x_1)))$. We take a look at a proof of $\forall x_0\exists x_1: r(x_0, x_1)$ which hopefully gives us $h\circ g\circ f$. First consider the output of vampire

\setcounter{equation}{0}
\begin{align}
	[\text{axiom}] && \forall x_0: p(x_0,f(x_0))\\
	[\text{axiom}] && \forall x_0, x_1 : (p(x_0,x_1) \Rightarrow q(x_0,g(x_1)))\\
	[\text{axiom}] && \forall x_0, x_1 : (q(x_0,x_1) \Rightarrow r(x_0,h(x_1)))\\
	[\text{negated conjecture}] &&\neg\forall  x_0 : \exists x_1 : r(x_0,x_1)\\
	[\text{ennf transformation 2}] && \forall x_0, x_1 : (q(x_0,g(x_1)) \vee \neg p(x_0,x_1)) \\
	[\text{ennf transformation 3}] &&\forall x_0, x_1 : (r(x_0,h(x_1)) \vee \neg q(x_0, x_1)) \\
	[\text{ennf transformation 4}] && \exists x_0 \forall x_1 : \neg r(x_0, x_1)\\
	[\text{choice axiom}] && \exists x_0 \forall x_1 : \neg r(x_0, x_1) \Rightarrow \forall x_1 : \neg r(s_0,x_1)\\
	[\text{skolemisation 7,8}] && \forall x_1 : \neg r(s_0, x_1)\\
	[\text{cnf transformation 1}] && p(x_0,f(x_0))\\
	[\text{cnf transformation 5}] && q(x_1,g(x_2)) \vee \neg p(x_1, x_2)\\
	[\text{cnf transformation 6}] && r(x_3,h(x_4)) \vee \neg q(x_3, x_4)\\
	[\text{cnf transformation 9}] &&. \neg r(s_0,x_5)\\
	[\text{resolution 12, 13}] &\{x_3\mapsto s_0, x_5\mapsto h(x_4)\}& \neg q(s_0,x_4)\\
	[\text{resolution 14, 11}] &\{x_1\mapsto s_0, x_4\mapsto g(x_2)\}&\neg p(s_0,x_2)\\
	[\text{resolution 15, 10}] &\{x_0\mapsto s_0, x_2\mapsto f(s_0)\}& \bot
\end{align}

Again replace negated conjecture by tautology

\setcounter{equation}{0}
\begin{align}
	[\text{axiom}] && \forall x_0: p(x_0,f(x_0))\\
	[\text{axiom}] && \forall x_0, x_1 : (p(x_0,x_1) \Rightarrow q(x_0,g(x_1)))\\
	[\text{axiom}] && \forall x_0, x_1 : (q(x_0,x_1) \Rightarrow r(x_0,h(x_1)))\\
	[\text{tautology}] &&\forall  x_0 \exists x_1 : r(x_0,x_1)\vee \neg\forall  x_0 \exists x_1 : r(x_0,x_1)\\
	[\text{ennf transformation 2}] && \forall x_0, x_1 : (q(x_0,g(x_1)) \vee \neg p(x_0,x_1)) \\
	[\text{ennf transformation 3}] &&\forall x_0, x_1 : (r(x_0,h(x_1)) \vee \neg q(x_0, x_1)) \\
	[\text{ennf transformation 4}] && \forall  x_0 : \exists x_1 : r(x_0,x_1)\vee \exists x_0 \forall x_1 : \neg r(x_0, x_1)\\
	[\text{choice axiom}] && \exists x_0 : \forall x_1 : \neg r(x_0, x_1) \Rightarrow \forall x_1 : \neg r(s_0,x_1)\\
	[\text{choice axiom}] &&\forall x_0(\exists x_1: r(x_0, x_1)\Rightarrow r(x_0, s_1(x_0)))\\
	[\text{skolemisation 7,8}] && \forall  x_0 \exists x_1 : r(x_0,x_1)\vee \forall x_1 : \neg r(s_0, x_1)\\
	[\text{skolemisation 9,10}] && \forall  x_0 :  r(x_0, s_1(x_0))\vee \forall x_1 : \neg r(s_0, x_1)\\
	[\text{cnf transformation 1}] && p(x_0,f(x_0))\\
	[\text{cnf transformation 5}] && q(x_1,g(x_2)) \vee \neg p(x_1, x_2)\\
	[\text{cnf transformation 6}] && r(x_3,h(x_4)) \vee \neg q(x_3, x_4)\\
	[\text{cnf transformation 11}] && r(x_6, s_1(x_6))\vee\neg r(s_0, x_5)\\
	[\text{resolution 14, 15}] &\{x_3\mapsto s_0, x_5\mapsto h(x_4)\}&r(x_6, s_1(x_6))\vee \neg q(s_0,x_4)\\
	[\text{resolution 16, 13}] &\{x_1\mapsto s_0, x_4\mapsto g(x_2)\}&r(x_6, s_1(x_6))\vee\neg p(s_0,x_2)\\
	[\text{resolution 17, 12}] &\{x_0\mapsto s_0, x_2\mapsto f(s_0)\}&r(x_6, s_1(x_6))
\end{align}

We propagate the substitutions

\setcounter{equation}{0}
\begin{align}
	[\text{axiom}] && \forall x_0: p(x_0,f(x_0))\\
	[\text{axiom}] && \forall x_0, x_1 : (p(x_0,x_1) \Rightarrow q(x_0,g(x_1)))\\
	[\text{axiom}] && \forall x_0, x_1 : (q(x_0,x_1) \Rightarrow r(x_0,h(x_1)))\\
	[\text{tautology}] &&\forall  x_0 \exists x_1 : r(x_0,x_1)\vee \neg\forall  x_0 \exists x_1 : r(x_0,x_1)\\
	[\text{ennf transformation 2}] && \forall x_0, x_1 : (q(x_0,g(x_1)) \vee \neg p(x_0,x_1)) \\
	[\text{ennf transformation 3}] &&\forall x_0, x_1 : (r(x_0,h(x_1)) \vee \neg q(x_0, x_1)) \\
	[\text{ennf transformation 4}] && \forall  x_0 : \exists x_1 : r(x_0,x_1)\vee \exists x_0 \forall x_1 : \neg r(x_0, x_1)\\
	[\text{choice axiom}] && \exists x_0 : \forall x_1 : \neg r(x_0, x_1) \Rightarrow \forall x_1 : \neg r(s_0,x_1)\\
	[\text{choice axiom}] &&\forall x_0(\exists x_1: r(x_0, x_1)\Rightarrow r(x_0, s_1(x_0)))\\
	[\text{skolemisation 7,8}] && \forall  x_0 \exists x_1 : r(x_0,x_1)\vee \forall x_1 : \neg r(s_0, x_1)\\
	[\text{skolemisation 9,10}] && \forall  x_0 :  r(x_0, s_1(x_0))\vee \forall x_1 : \neg r(s_0, x_1)\\
	[\text{cnf transformation 1}] && p(x_0,f(x_0))\\
	[\text{cnf transformation 5}] && q(x_1,g(x_2)) \vee \neg p(x_1, x_2)\\
	[\text{cnf transformation 6}] && r(s_0,h(x_4)) \vee \neg q(s_0, x_4)\\
	[\text{cnf transformation 11}] && r(x_6, s_1(x_6))\vee\neg r(s_0,h(x_4))\\
	[\text{resolution 14, 15}] &\{\}&r(x_6, s_1(x_6))\vee\neg q(s_0,x_4)\\
	[\text{resolution 16, 13}] &\{x_1\mapsto s_0, x_4\mapsto g(x_2)\}&r(x_6, s_1(x_6))\vee\neg p(s_0,x_2)\\
	[\text{resolution 17, 12}] &\{x_0\mapsto s_0, x_2\mapsto f(s_0)\}&r(x_6, s_1(x_6))
\end{align}

\setcounter{equation}{0}
\begin{align}
	[\text{axiom}] && \forall x_0: p(x_0,f(x_0))\\
	[\text{axiom}] && \forall x_0, x_1 : (p(x_0,x_1) \Rightarrow q(x_0,g(x_1)))\\
	[\text{axiom}] && \forall x_0, x_1 : (q(x_0,x_1) \Rightarrow r(x_0,h(x_1)))\\
	[\text{tautology}] &&\forall  x_0 \exists x_1 : r(x_0,x_1)\vee \neg\forall  x_0 \exists x_1 : r(x_0,x_1)\\
	[\text{ennf transformation 2}] && \forall x_0, x_1 : (q(x_0,g(x_1)) \vee \neg p(x_0,x_1)) \\
	[\text{ennf transformation 3}] &&\forall x_0, x_1 : (r(x_0,h(x_1)) \vee \neg q(x_0, x_1)) \\
	[\text{ennf transformation 4}] && \forall  x_0 : \exists x_1 : r(x_0,x_1)\vee \exists x_0 \forall x_1 : \neg r(x_0, x_1)\\
	[\text{choice axiom}] && \exists x_0 : \forall x_1 : \neg r(x_0, x_1) \Rightarrow \forall x_1 : \neg r(s_0,x_1)\\
	[\text{choice axiom}] &&\forall x_0(\exists x_1: r(x_0, x_1)\Rightarrow r(x_0, s_1(x_0)))\\
	[\text{skolemisation 7,8}] && \forall  x_0 \exists x_1 : r(x_0,x_1)\vee \forall x_1 : \neg r(s_0, x_1)\\
	[\text{skolemisation 9,10}] && \forall  x_0 :  r(x_0, s_1(x_0))\vee \forall x_1 : \neg r(s_0, x_1)\\
	[\text{cnf transformation 1}] && p(x_0,f(x_0))\\
	[\text{cnf transformation 5}] && q(s_0,g(x_2)) \vee \neg p(s_0, x_2)\\
	[\text{cnf transformation 6}] && r(s_0,h(g(x_2))) \vee \neg q(s_0, g(x_2))\\
	[\text{cnf transformation 11}] && r(x_6, s_1(x_6))\vee\neg r(s_0,h(g(x_2)))\\
	[\text{resolution 14, 15}] &\{\}&r(x_6, s_1(x_6))\vee\neg q(s_0,g(x_2))\\
	[\text{resolution 16, 13}] &\{\}&r(x_6, s_1(x_6))\vee\neg p(s_0,x_2)\\
	[\text{resolution 17, 12}] &\{x_0\mapsto s_0, x_2\mapsto f(s_0)\}&r(x_6, s_1(x_6))
\end{align}

\setcounter{equation}{0}
\begin{align}
	[\text{axiom}] && \forall x_0: p(x_0,f(x_0))\\
	[\text{axiom}] && \forall x_0, x_1 : (p(x_0,x_1) \Rightarrow q(x_0,g(x_1)))\\
	[\text{axiom}] && \forall x_0, x_1 : (q(x_0,x_1) \Rightarrow r(x_0,h(x_1)))\\
	[\text{tautology}] &&\forall  x_0 \exists x_1 : r(x_0,x_1)\vee \neg\forall  x_0 \exists x_1 : r(x_0,x_1)\\
	[\text{ennf transformation 2}] && \forall x_0, x_1 : (q(x_0,g(x_1)) \vee \neg p(x_0,x_1)) \\
	[\text{ennf transformation 3}] &&\forall x_0, x_1 : (r(x_0,h(x_1)) \vee \neg q(x_0, x_1)) \\
	[\text{ennf transformation 4}] && \forall  x_0 : \exists x_1 : r(x_0,x_1)\vee \exists x_0 \forall x_1 : \neg r(x_0, x_1)\\
	[\text{choice axiom}] && \exists x_0 : \forall x_1 : \neg r(x_0, x_1) \Rightarrow \forall x_1 : \neg r(s_0,x_1)\\
	[\text{choice axiom}] &&\forall x_0(\exists x_1: r(x_0, x_1)\Rightarrow r(x_0, s_1(x_0)))\\
	[\text{skolemisation 7,8}] && \forall  x_0 \exists x_1 : r(x_0,x_1)\vee \forall x_1 : \neg r(s_0, x_1)\\
	[\text{skolemisation 9,10}] && \forall  x_0 :  r(x_0, s_1(x_0))\vee \forall x_1 : \neg r(s_0, x_1)\\
	[\text{cnf transformation 1}] && p(s_0, f(s_0))\\
	[\text{cnf transformation 5}] && q(s_0,g(f(s_0))) \vee \neg p(s_0, f(s_0))\\
	[\text{cnf transformation 6}] && r(s_0,h(g(f(s_0)))) \vee \neg q(s_0, g(f(s_0)))\\
	[\text{cnf transformation 11}] && r(x_6, s_1(x_6))\vee\neg r(s_0,h(g(f(s_0))))\\
	[\text{resolution 14, 15}] &\{\}&r(x_6, s_1(x_6))\vee\neg q(s_0,g(f(s_0)))\\
	[\text{resolution 16, 13}] &\{\}&r(x_6, s_1(x_6))\vee\neg p(s_0,f(s_0))\\
	[\text{resolution 17, 12}] &\{\}&r(x_6, s_1(x_6))
\end{align}

Then unification at 15 gives $s_1 = h\circ g\circ f$ and $s_0 = x_6$ and the final transformation gives: 


\setcounter{equation}{0}
\begin{align}
	[\text{axiom}] && \forall x_0: p(x_0,f(x_0))\\
	[\text{axiom}] && \forall x_0, x_1 : (p(x_0,x_1) \Rightarrow q(x_0,g(x_1)))\\
	[\text{axiom}] && \forall x_0, x_1 : (q(x_0,x_1) \Rightarrow r(x_0,h(x_1)))\\
	[\text{instantiation 1}] && p(x_6, f(x_6))\\
	[\text{instantiation 2}] && p(x_6, f(x_6))\Rightarrow q(x_6,g(f(x_6))) \\
	[\text{instantiation 3}] && q(x_6, g(f(x_6)))\Rightarrow r(x_6,h(g(f(x_6)))) \\
	[\text{tautology}] && r(x_6, h(g(f(x_6))))\Rightarrow r(x_6,h(g(f(x_6))))\\
	[\text{composition 6, 7}] &\{\}&q(x_6, g(f(x_6)))\Rightarrow r(x_6,h(g(f(x_6))))\\
	[\text{composition 5, 8}] &\{\}&p(x_6,f(x_6))\Rightarrow r(x_6, h(g(f(x_6))))\\
	[\text{composition 4, 9}] &\{\}&r(x_6, h(g(f(x_6))))
\end{align}

\pagebreak

\setcounter{equation}{0}
\begin{align}
	[\text{axiom}] && \forall x_0: p(x_0,f(x_0))\\
	[\text{axiom}] && \forall x_0, x_1 : (p(x_0,x_1) \Rightarrow q(x_0,g(x_1)))\\
	[\text{axiom}] && \forall x_0, x_1 : (q(x_0,x_1) \Rightarrow r(x_0,h(x_1)))\\
	[\text{negated conjecture}] &&\neg\forall  x_0 : \exists x_1 : r(x_0,x_1)\\
	[\text{ennf transformation 2}] && \forall x_0, x_1 : (q(x_0,g(x_1)) \vee \neg p(x_0,x_1)) \\
	[\text{ennf transformation 3}] &&\forall x_0, x_1 : (r(x_0,h(x_1)) \vee \neg q(x_0, x_1)) \\
	[\text{ennf transformation 4}] && \exists x_0 \forall x_1 : \neg r(x_0, x_1)\\
	[\text{choice axiom}] && \exists x_0 \forall x_1 : \neg r(x_0, x_1) \Rightarrow \forall x_1 : \neg r(s_0,x_1)\\
	[\text{skolemisation 7,8}] && \forall x_1 : \neg r(s_0, x_1)\\
	[\text{cnf transformation 1}] && p(x_0,f(x_0))\\
	[\text{cnf transformation 5}] && q(x_1,g(x_2)) \vee \neg p(x_1, x_2)\\
	[\text{cnf transformation 6}] && r(x_3,h(x_4)) \vee \neg q(x_3, x_4)\\
	[\text{cnf transformation 9}] &&. \neg r(s_0,x_5)\\
	[\text{resolution 12, 13}] &\{x_3\mapsto s_0, x_5\mapsto h(x_4)\}& \neg q(s_0,x_4)\\
	[\text{resolution 14, 11}] &\{x_1\mapsto s_0, x_4\mapsto g(x_2)\}&\neg p(s_0,x_2)\\
	[\text{resolution 15, 10}] &\{x_0\mapsto s_0, x_2\mapsto f(s_0)\}& \bot
\end{align}

Again replace negated conjecture by tautology

\setcounter{equation}{0}
\begin{align}
	[\text{axiom}] && \forall x_0: p(x_0,f(x_0))\\
	[\text{axiom}] && \forall x_0, x_1 : (p(x_0,x_1) \Rightarrow q(x_0,g(x_1)))\\
	[\text{axiom}] && \forall x_0, x_1 : (q(x_0,x_1) \Rightarrow r(x_0,h(x_1)))\\
	[\text{tautology}] &&\forall  x_0 \exists x_1 : r(x_0,x_1)\vee \neg\forall  x_0 \exists x_1 : r(x_0,x_1)\\
	[\text{ennf transformation 2}] && \forall x_0, x_1 : (q(x_0,g(x_1)) \vee \neg p(x_0,x_1)) \\
	[\text{ennf transformation 3}] &&\forall x_0, x_1 : (r(x_0,h(x_1)) \vee \neg q(x_0, x_1)) \\
	[\text{ennf transformation 4}] && \forall  x_0 : \exists x_1 : r(x_0,x_1)\vee \exists x_0 \forall x_1 : \neg r(x_0, x_1)\\
	[\text{choice axiom}] && \exists x_0 : \forall x_1 : \neg r(x_0, x_1) \Rightarrow \forall x_1 : \neg r(s_0,x_1)\\
	[\text{choice axiom}] &&\forall x_0(\exists x_1: r(x_0, x_1)\Rightarrow r(x_0, s_1(x_0)))\\
	[\text{skolemisation 7,8}] && \forall  x_0 \exists x_1 : r(x_0,x_1)\vee \forall x_1 : \neg r(s_0, x_1)\\
	[\text{skolemisation 9,10}] && \forall  x_0 :  r(x_0, s_1(x_0))\vee \forall x_1 : \neg r(s_0, x_1)\\
	[\text{cnf transformation 1}] && p(x_0,f(x_0))\\
	[\text{cnf transformation 5}] && q(x_1,g(x_2)) \vee \neg p(x_1, x_2)\\
	[\text{cnf transformation 6}] && r(x_3,h(x_4)) \vee \neg q(x_3, x_4)\\
	[\text{cnf transformation 11}] && r(x_6, s_1(x_6))\vee\neg r(s_0, x_5)\\
	[\text{resolution 14, 15}] &\{x_3\mapsto s_0, x_5\mapsto h(x_4)\}&r(x_6, s_1(x_6))\vee \neg q(s_0,x_4)\\
	[\text{resolution 16, 13}] &\{x_1\mapsto s_0, x_4\mapsto g(x_2)\}&r(x_6, s_1(x_6))\vee\neg p(s_0,x_2)\\
	[\text{resolution 17, 12}] &\{x_0\mapsto s_0, x_2\mapsto f(s_0)\}&r(x_6, s_1(x_6))
\end{align}

We propagate the substitutions

\setcounter{equation}{0}
\begin{align}
	[\text{axiom}] && \forall x_0: p(x_0,f(x_0))\\
	[\text{axiom}] && \forall x_0, x_1 : (p(x_0,x_1) \Rightarrow q(x_0,g(x_1)))\\
	[\text{axiom}] && \forall x_0, x_1 : (q(x_0,x_1) \Rightarrow r(x_0,h(x_1)))\\
	[\text{tautology}] &&\forall  x_0 \exists x_1 : r(x_0,x_1)\vee \neg\forall  x_0 \exists x_1 : r(x_0,x_1)\\
	[\text{ennf transformation 2}] && \forall x_0, x_1 : (q(x_0,g(x_1)) \vee \neg p(x_0,x_1)) \\
	[\text{ennf transformation 3}] &&\forall x_0, x_1 : (r(x_0,h(x_1)) \vee \neg q(x_0, x_1)) \\
	[\text{ennf transformation 4}] && \forall  x_0 : \exists x_1 : r(x_0,x_1)\vee \exists x_0 \forall x_1 : \neg r(x_0, x_1)\\
	[\text{choice axiom}] && \exists x_0 : \forall x_1 : \neg r(x_0, x_1) \Rightarrow \forall x_1 : \neg r(s_0,x_1)\\
	[\text{choice axiom}] &&\forall x_0(\exists x_1: r(x_0, x_1)\Rightarrow r(x_0, s_1(x_0)))\\
	[\text{skolemisation 7,8}] && \forall  x_0 \exists x_1 : r(x_0,x_1)\vee \forall x_1 : \neg r(s_0, x_1)\\
	[\text{skolemisation 9,10}] && \forall  x_0 :  r(x_0, s_1(x_0))\vee \forall x_1 : \neg r(s_0, x_1)\\
	[\text{cnf transformation 1}] && p(x_0,f(x_0))\\
	[\text{cnf transformation 5}] && q(x_1,g(x_2)) \vee \neg p(x_1, x_2)\\
	[\text{cnf transformation 6}] && r(s_0,h(x_4)) \vee \neg q(s_0, x_4)\\
	[\text{cnf transformation 11}] && r(x_6, s_1(x_6))\vee\neg r(s_0,h(x_4))\\
	[\text{resolution 14, 15}] &\{\}&r(x_6, s_1(x_6))\vee\neg q(s_0,x_4)\\
	[\text{resolution 16, 13}] &\{x_1\mapsto s_0, x_4\mapsto g(x_2)\}&r(x_6, s_1(x_6))\vee\neg p(s_0,x_2)\\
	[\text{resolution 17, 12}] &\{x_0\mapsto s_0, x_2\mapsto f(s_0)\}&r(x_6, s_1(x_6))
\end{align}

\setcounter{equation}{0}
\begin{align}
	[\text{axiom}] && \forall x_0: p(x_0,f(x_0))\\
	[\text{axiom}] && \forall x_0, x_1 : (p(x_0,x_1) \Rightarrow q(x_0,g(x_1)))\\
	[\text{axiom}] && \forall x_0, x_1 : (q(x_0,x_1) \Rightarrow r(x_0,h(x_1)))\\
	[\text{tautology}] &&\forall  x_0 \exists x_1 : r(x_0,x_1)\vee \neg\forall  x_0 \exists x_1 : r(x_0,x_1)\\
	[\text{ennf transformation 2}] && \forall x_0, x_1 : (q(x_0,g(x_1)) \vee \neg p(x_0,x_1)) \\
	[\text{ennf transformation 3}] &&\forall x_0, x_1 : (r(x_0,h(x_1)) \vee \neg q(x_0, x_1)) \\
	[\text{ennf transformation 4}] && \forall  x_0 : \exists x_1 : r(x_0,x_1)\vee \exists x_0 \forall x_1 : \neg r(x_0, x_1)\\
	[\text{choice axiom}] && \exists x_0 : \forall x_1 : \neg r(x_0, x_1) \Rightarrow \forall x_1 : \neg r(s_0,x_1)\\
	[\text{choice axiom}] &&\forall x_0(\exists x_1: r(x_0, x_1)\Rightarrow r(x_0, s_1(x_0)))\\
	[\text{skolemisation 7,8}] && \forall  x_0 \exists x_1 : r(x_0,x_1)\vee \forall x_1 : \neg r(s_0, x_1)\\
	[\text{skolemisation 9,10}] && \forall  x_0 :  r(x_0, s_1(x_0))\vee \forall x_1 : \neg r(s_0, x_1)\\
	[\text{cnf transformation 1}] && p(x_0,f(x_0))\\
	[\text{cnf transformation 5}] && q(s_0,g(x_2)) \vee \neg p(s_0, x_2)\\
	[\text{cnf transformation 6}] && r(s_0,h(g(x_2))) \vee \neg q(s_0, g(x_2))\\
	[\text{cnf transformation 11}] && r(x_6, s_1(x_6))\vee\neg r(s_0,h(g(x_2)))\\
	[\text{resolution 14, 15}] &\{\}&r(x_6, s_1(x_6))\vee\neg q(s_0,g(x_2))\\
	[\text{resolution 16, 13}] &\{\}&r(x_6, s_1(x_6))\vee\neg p(s_0,x_2)\\
	[\text{resolution 17, 12}] &\{x_0\mapsto s_0, x_2\mapsto f(s_0)\}&r(x_6, s_1(x_6))
\end{align}

\setcounter{equation}{0}
\begin{align}
	[\text{axiom}] && \forall x_0: p(x_0,f(x_0))\\
	[\text{axiom}] && \forall x_0, x_1 : (p(x_0,x_1) \Rightarrow q(x_0,g(x_1)))\\
	[\text{axiom}] && \forall x_0, x_1 : (q(x_0,x_1) \Rightarrow r(x_0,h(x_1)))\\
	[\text{tautology}] &&\forall  x_0 \exists x_1 : r(x_0,x_1)\vee \neg\forall  x_0 \exists x_1 : r(x_0,x_1)\\
	[\text{ennf transformation 2}] && \forall x_0, x_1 : (q(x_0,g(x_1)) \vee \neg p(x_0,x_1)) \\
	[\text{ennf transformation 3}] &&\forall x_0, x_1 : (r(x_0,h(x_1)) \vee \neg q(x_0, x_1)) \\
	[\text{ennf transformation 4}] && \forall  x_0 : \exists x_1 : r(x_0,x_1)\vee \exists x_0 \forall x_1 : \neg r(x_0, x_1)\\
	[\text{choice axiom}] && \exists x_0 : \forall x_1 : \neg r(x_0, x_1) \Rightarrow \forall x_1 : \neg r(s_0,x_1)\\
	[\text{choice axiom}] &&\forall x_0(\exists x_1: r(x_0, x_1)\Rightarrow r(x_0, s_1(x_0)))\\
	[\text{skolemisation 7,8}] && \forall  x_0 \exists x_1 : r(x_0,x_1)\vee \forall x_1 : \neg r(s_0, x_1)\\
	[\text{skolemisation 9,10}] && \forall  x_0 :  r(x_0, s_1(x_0))\vee \forall x_1 : \neg r(s_0, x_1)\\
	[\text{cnf transformation 1}] && p(s_0, f(s_0))\\
	[\text{cnf transformation 5}] && q(s_0,g(f(s_0))) \vee \neg p(s_0, f(s_0))\\
	[\text{cnf transformation 6}] && r(s_0,h(g(f(s_0)))) \vee \neg q(s_0, g(f(s_0)))\\
	[\text{cnf transformation 11}] && r(x_6, s_1(x_6))\vee\neg r(s_0,h(g(f(s_0))))\\
	[\text{resolution 14, 15}] &\{\}&r(x_6, s_1(x_6))\vee\neg q(s_0,g(f(s_0)))\\
	[\text{resolution 16, 13}] &\{\}&r(x_6, s_1(x_6))\vee\neg p(s_0,f(s_0))\\
	[\text{resolution 17, 12}] &\{\}&r(x_6, s_1(x_6))
\end{align}

Then unification at 15 gives $s_1 = h\circ g\circ f$ and $s_0 = x_6$ and the final transformation gives: 


\setcounter{equation}{0}
\begin{align}
	[\text{axiom}] && \forall x_0: p(x_0,f(x_0))\\
	[\text{axiom}] && \forall x_0, x_1 : (p(x_0,x_1) \Rightarrow q(x_0,g(x_1)))\\
	[\text{axiom}] && \forall x_0, x_1 : (q(x_0,x_1) \Rightarrow r(x_0,h(x_1)))\\
	[\text{instantiation 1}] && p(x_6, f(x_6))\\
	[\text{instantiation 2}] && p(x_6, f(x_6))\Rightarrow q(x_6,g(f(x_6))) \\
	[\text{instantiation 3}] && q(x_6, g(f(x_6)))\Rightarrow r(x_6,h(g(f(x_6)))) \\
	[\text{tautology}] && r(x_6, h(g(f(x_6))))\Rightarrow r(x_6,h(g(f(x_6))))\\
	[\text{composition 6, 7}] &\{\}&q(x_6, g(f(x_6)))\Rightarrow r(x_6,h(g(f(x_6))))\\
	[\text{composition 5, 8}] &\{\}&p(x_6,f(x_6))\Rightarrow r(x_6, h(g(f(x_6))))\\
	[\text{composition 4, 9}] &\{\}&r(x_6, h(g(f(x_6))))
\end{align}





\pagebreak
\bibliographystyle{acm}
\bibliography{references}

\end{document}