\documentclass{easychair}
\usepackage{amsmath, amsfonts, amsthm}
\usepackage{wrapfig}
\usepackage{multicol}
\usepackage[T1]{fontenc}
\usepackage{todonotes}
%
\usepackage{tikz}
\usetikzlibrary{shapes,backgrounds}

\theoremstyle{definition}
\newtheorem{theorem}{Theorem}[section]
\theoremstyle{definition}
\newtheorem{corollary}[theorem]{Corollary}
\theoremstyle{definition}
\newtheorem{lemma}[theorem]{Lemma}
\theoremstyle{definition}
\newtheorem{proposition}[theorem]{Proposition}
\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}
\theoremstyle{definition}
\newtheorem{example}[theorem]{Example}
\theoremstyle{definition}
\newtheorem{remark}[theorem]{Remark}


\begin{document}
	%
	\title{Embedding Intuitionistic into Classical Logic}
	%
	%\titlerunning{Abbreviated paper title}
	% If the paper title is too long for the running head, you can set
	% an abbreviated paper title here
	%
	\author{Alexander Pluska \and Florian Zuleger}
	%
	\authorrunning{A. Pluska and F. Zuleger}
	\titlerunning{Embedding Intuitionistic into Classical Logic}
	% First names are abbreviated in the running head.
	% If there are more than two authors, 'et al.' is used.
	%
	\institute{TU Wien, Vienna, Austria}
	%
	\maketitle
\begin{abstract}
The famous double negation translation~\cite{glivenko1929quelques,godel1933intuitionistischen} establishes an embedding of classical into intuitionistic logic.
Curiously, the reverse direction has not been covered in literature.
Utilizing a normal form for intuitionistic logic~\cite{claessen2015sat}, we establish a small model property for intuitionistic propositional logic.
We use this property for a direct encoding of the Kripke semantics into classical propositional logic and quantified boolean formulas.
Next, we transfer the developed techniques to the first order case and provide an embedding of intuitionistic first-order logic into classical first-order-logic.
Our goal here is an encoding that facilitates the use of state-of-the-art provers for classical first-order logic for determining intuitionistic validity.
In an experimental evaluation, we show that our approach can compete with state-of-the-art provers for certain classes of benchmarks, in particular when the intuitionistic content is low.
We further note that our constructions support the transfer of counter-models to validity, which is a desired feature in model checking applications.
\end{abstract}

\section{Introduction}

Constructive mathematics refers to a flavor of mathematics in which the existence of an object can only be established by explicit construction, as opposed to classical mathematics where existence can be shown implicitly, e.g. by assuming non-existence and deriving a contradiction.
The formalism usually associated with constructive mathematics is intuitionistic logic, which essentially differentiates itself from classical logic by the fact that the law of excluded middle $A\vee\neg A$ and the double negation shift $\forall x\neg\neg P(x)\to\neg\neg\forall xP(x)$ are not valid.
Besides philosophical considerations, most prominently advocated by Brouwer~\cite{brouwer1907over} and Bishop~\cite{bishop1967foundations}, there is a particular motivation for studying constructive mathematics from the perspective of computer science in that proofs in intuitionistic logic directly correspond to computer programs --- as expressed in the Curry--Howard correspondence~\cite{howard1980formulae}.

The interest in intuitionistic logic has lead to the development of a number of automated theorem proving systems and a collection of benchmark problems (see e.g. the ILTP library website~\cite{iltp}).
The progress in automated reasoning for intuitionistic logic, however, has been slower than the  impressive advances in solvers for classic logics --- evidenced, e.g., by the CASC~\cite{casc} and SAT~\cite{satc} competitions.
%, e.g., the first-order provers~\cite{kovacs2013first, schulz2002brainiac, korovin2008iprover}
%Comparing benchmarks for classical and intuitionistic automated theorem proving, e.g. TPTP~\cite{casc} and , we see that classical provers currently have a far better success rate. Furthermore all the most popular first-order utilize classical logic.
This difference can partially be explained by fundamental differences between the logics.
First of all, determining intuitionistic validity is computationally harder, e.g., in the propositional case intuitionistic validity is \verb+PSPACE+-complete~\cite{statman1979intuitionistic}, whereas classical validity is \verb+coNP+-complete~\cite{cook1971complexity}.
A further advantage of classical logic is the existence of calculi that are particularly suited for automation, such as superposition~\cite{bachmair2001resolution}, which rely on the existence of convenient normal forms such as CNF, and the duality between validity and satisfiability (i.e., in order to show the validity of a formula it suffices to show the unsatisfiability of the negated formula, which is insufficient in intuitionistic logic).
The first dedicated intuitionistic theorem provers~\cite{mclaughlin2009efficient,tammet1996resolution} used the na√Øve inverse method, i.e., a direct search for a cut-free proof by applying the rules from some proof calculus inversely, which generally leads to a very complex search. 
More recently, connection-based methods have been applied to various non-classical logics~\cite{otten2005clausal,otten2021nanocop}, including intuitionistic logic.
There have also been some successful attempts to study intuitionistic validity via embedding into higher-order classical logic~\cite{LEO}.
We finally add that, in contrast to intuitionistic provers, a tremendous amount of work has been put into optimizing provers for classical logic.

With this work we want to leverage the progress in classical reasoning for intuitionistic logic.
To this end, we study embeddings of intuitionistic into classical logic and propose the following methodology:
\begin{itemize}
	\item Translate an input formula $\varphi$ to a formula $\varphi^\#$, which is classically valid if and only if $\varphi$ is intuitionistically valid.
	\item Determine the classical validity of $\varphi^\#$ using a prover for classical logic, resulting in a proof or counter-model.
	\item Translate the classical proof/counter-model of $\varphi^\#$ to a corresponding intuitionistic proof/counter-model of $\varphi$.
\end{itemize}
\subsection*{Contributions} 
We now overview the main results of this paper (which we discuss in more detail in Sections~\ref{sec:overview} and~\ref{sec:evaluation}):
\begin{itemize}
	\item We establish a small model property for counter-models to validity in intuitionistic propositional logic.
	\item Based on the small model property, we provide an embedding of intuitionistic propositional logic into classical propositional logic and into quantified boolean formulas.
	\item We discuss the reduction of counter-models in intuitionistic first-order logic and, based on this reduction, present an embedding of intuitionistic into classical first-order logic.
	\item We provide an experimental evaluation on the use of first-order provers for classical logic for determining intuitionistic validity.
 We show that our approach can compete with state-of-the-art provers for certain classes of benchmarks, in particular when the intuitionistic content is low.
\end{itemize}

\subsection*{Related work}
The famous double-negation translation establishes
an embedding of classical into intuitionistic logic, going back to Glivenko~\cite{glivenko1929quelques} in the propositional case, and to G\"odel~\cite{godel1933intuitionistischen} and Gentzen~\cite{gentzen1936widerspruchsfreiheit} in the first-order case.
In the propositional case the embedding is particularly simple: 
A formula $\varphi$ is classically valid if and only if $\neg\neg\varphi$ is intuitionistically valid. 
Intuitively, the translation collapses for each subformula $\psi$ of $\varphi$ the truth values of $\psi$ and $\neg\neg\psi$, which are classically but not intuitionistically equivalent.
For embedding intuitionistic into classical logic, we need to do the opposite:
We need to expand the truth values of $\psi$ and $\neg\neg\psi$, i.e., if they both occur in $\varphi$, we must have a way to (classically) assign different truth values to their respective counterparts in $\varphi^\#$.
This necessitates the introduction of new propositional variables in our procedure, which marks a big difference to the double negation translation.

We further mention some translations between logics from the literature.
Most relevant are the embedding of intuitionistic logic into S4~\cite{basicprooftheory} and of various non-classical logics into higher-order classical logic~\cite{LEO,wisniewski2016tptp}.
Of special relevance are the normalization procedures for intuitionistic propositional logic given in~\cite{claessen2015sat}
and examined from a proof-theoretic perspective in~\cite{fiorentini2019proof}, which we further expand upon in this paper.

We finally mention a long-standing line of research that has investigated when classical validity implies intuitionistic validity.
This most famously holds for $\Pi_2$-formulas in Peano Arithmetic~\cite{friedman1978classically}, but also other conditions are known~\cite{schwichtenberg}. 
In contrast, we propose a translation of an intuitionistic formula to an equi-valid classical formula.

%Finally, of course dedicated theorem provers for intuitionistic logic exists, generally using the inverse method~\cite{mclaughlin2008imogen,pavlov2017whaleprover}, but more recently also based on connection-based calculi~\cite{otten2008leancop,otten2021nanocop}, which also work well for classical logic.

\section{Preliminaries}

In this section we fix notation and recall the semantics for classical and intuitionistic logic. Furthermore we recapitulate some results from~\cite{otten2005clausal}.

\subsection{Syntax}

For propositional logic we assume an ambient set of propositional variables. A propositional formula is defined inductively as follows:
\begin{itemize}
	\item The propositional constant $\bot$ is a formula.
	\item Each propositional variable is a formula.
	\item Given formulas $\varphi$ and $\psi$ and a connector $\circ\in\{\wedge, \vee,\to\}$ there is a formula $\varphi\circ\psi$.
\end{itemize}

For predicate logic we assume an ambient signature $\Sigma$, i.e., a set of function and predicate symbols with their respective arities, and sets of free and bound variables. Generally free variables will be denoted will letters at the beginning of the alphabet while bound variables will be denoted with letters at the end of the alphabet. $\nu$ will usually be a placeholder that can be instantiated with free or bound variables. We can define terms $t$ and substitutions $t[\nu/b]$ by simultaneous induction as follows:
\begin{itemize}
	\item Each free variable $a$ is a term and $a[\nu/b] := \begin{cases}
		\nu & \text{if } a = b \\
		a & \text{otherwise}
	\end{cases}$.
	\item For each $n$-ary function symbol $f$ and terms $t_1, \ldots, t_n$ we have that $f(t_1, \ldots, t_n)$ is a term and $f(t_1, \ldots, t_n)[\nu/b] := f(t_1[\nu/b], \ldots, t_n[\nu/b])$.
\end{itemize}
We can then define formulas $\varphi$ and substitutions $\varphi[\nu/b]$ by simultaneous induction as follows:
\begin{itemize}
	\item The constant $\bot$ is a formula and $\bot[\nu/b] := \bot$.
	\item For each $n$-ary predicate symbol $P$ and terms $t_1, \ldots, t_n$ we have that $P(t_1, \ldots, t_n)$ is a formula and $P(t_1,\ldots, t_n)[\nu/b] := P(t_1[\nu/b], \ldots, t_n[\nu/b])$.
	\item Given formulas $\varphi$ and $\psi$ and a connector $\circ\in \{\wedge,\vee,\to\}$ there is a formula $\varphi\circ\psi$ and $(\varphi\circ\psi)[\nu/b] := \varphi[\nu/b]\circ\psi[\nu/b]$.
	\item Given a formula $\varphi$, a free variable $a$, a bound variable $x$ not occurring in $\varphi$ and a quantifier $Q\in\{\exists,\forall\}$ there is a formula $Qx(\varphi[x/a])$ and $Qx(\varphi[x/a])[\nu/b] := Qx(\varphi[x/a][\nu/b])$.
\end{itemize}


\subsection{Propositional Semantics}

\begin{definition}
	A \emph{valuation} $v$ maps each propositional variable $A$ to a \emph{truth value} $v(A)\in\{0, 1\}$. We inductively define the model relation $\models$ between $v$ and formulas:
	\begin{itemize}
		\item $v\not\models \bot$
		\item $v\models A$ iff $v(A) = 1$ for each propositional variable $A$.
		\item $v\models \varphi\wedge\psi$ iff $v\models\varphi$ and $v\models\psi$.
		\item $v\models\varphi\vee\psi$ iff $v\models\varphi$ or $v\models\psi$.
		\item $v\models\varphi\to \psi$ iff $v\not\models\varphi$ or $v\models\psi$.
	\end{itemize}
	A valuation $v$ is a \emph{model} for $\varphi$ if $v\models\varphi$. If every valuation is a model for $\varphi$ then we say $\varphi$ is \emph{valid}. We denote the set of valid formulas with \emph{CPC} (Classical Propositional Calculus).
\end{definition}

One notable property of classical logic is that a formula $\varphi$ is valid if and only if its negation $\neg\varphi := \varphi\to\bot$ is not satisfiable, i.e. there does not exist a model for it. The same does not hold true for intuitionistic logic as we shall see.

\begin{definition}
	A \emph{Kripke structure} $\mathcal K = (W, (v_w)_{w\in W})$ consists of a partially ordered set $W$ of \emph{worlds}, called the Kripke \emph{frame}, and an indexed family of valuations $(v_w)_{w\in W}$ such that $v_u(A)\leq v_w(A)$ for all $u\leq w$ and propositional variables $A$ (this is called the \emph{persistency condition}).
	The model relation between the $v_u$ and formulas $\varphi$ is defined as before, except in the case of implications, where we set
	\begin{itemize}
		\item $v_u\models\varphi\to \psi$ iff for all $w\geq u$ we have $w\not\models\varphi$ or $w\models\psi$.
	\end{itemize}
	We say that $\varphi$ is satisfied at a world $u$ if $v_u\models\varphi$ and write $u\models\varphi$. If a formula is satisfied at every world then $\mathcal K$ is a \emph{model} for $\varphi$. A formula is valid if every Kripke structure is a model of it. We denote the set of valid formulas with \emph{IPC} (Intuitionistic Propositional Calculus).
\end{definition}
There are many classical tautologies which are not intuitionistically valid, e.g. the law of excluded middle $A\vee\neg A$. On the other hand any intuitionistic theorem is a classical one.

\subsection{Predicate Semantics}

We now recall the semantics of first-order logic:

\begin{definition}
	Let $\Sigma$ be a signature. A $\Sigma$-structure $\mathcal{M}$ consists of a non-empty set $M$, the \emph{domain} of $\mathcal{M}$, and an \emph{interpretation} $I$ that assigns
	\begin{itemize}
		\item to each $n$-ary function symbol $f\in\Sigma$ a $n$-ary function $f^I: M^n\to M$.
		\item to each $n$-ary predicate symbol $R\in\Sigma$ a $n$-ary predicate $R^I\subseteq M^n$.
	\end{itemize}
	A variable assignment $v$ is a function that assigns to each free variable an element $m\in M$. For each free variable $a$ and $m\in M$ we define $$v[m/a](b) = \begin{cases}
	m, &\text{if $b=a$,}\\
	v(b), &\text{otherwise.}
	\end{cases}$$
	Then terms are interpreted as follows:
	\begin{itemize}
		\item $a^{I, v} = v(a)$ for each free variable $a$.
		\item $f(t_1,\dots,t_n)^{I, v} = f^I(t_1^{I, v},\dots, t_n^{I, v})$ for each $n$-ary function symbol $f\in\Sigma$.
	\end{itemize}
	We define a model relation between pairs $\mathcal M, v$ and formulas $\varphi$ as follows
	\begin{itemize}
		\item $\mathcal M, v\not\models\bot$
		\item $\mathcal M, v\models R(t_1,\dots,t_n)$ iff $(t_1^{I, v},\dots,t_n^{I, v})\in R^I$, $\mathcal M, v\models s = t$ iff $s^{I, v} = t^{I, v}$.
		\item $\mathcal M, v\models \varphi\wedge \psi$ iff $\mathcal M, v\models\varphi$ and $\mathcal M, v\models\psi$
		\item $\mathcal M, v\models \varphi\vee\psi$ iff $\mathcal M, v\models\varphi$ or $\mathcal M, v\models\psi$.
		\item $\mathcal M, v\models \varphi\to\psi$ iff $\mathcal M, v\not\models\varphi$ or $\mathcal M, v\models\psi$.
		\item $\mathcal M, v\models\exists x\varphi$ iff there exists $m\in M$ such that $\mathcal M, v[m/a]\models\varphi[a/x]$.
		\item $\mathcal M, v\models\forall x\varphi$ iff for all $m\in M$ we have $\mathcal M, v[m/a]\models\varphi[a/x]$.
	\end{itemize}
	 Here $a$ is a free variable that does not occur in $\varphi$. A $\Sigma$-structure $\mathcal M$ satisfies $\varphi$ if $\mathcal M, v\models\varphi$ for every $v$, we write $\mathcal M\models\varphi$. A formula is valid if every $\Sigma$-structure $\mathcal M$ satisfies it. We denote the set of valid formulas with \emph{CQC} (Classical Quantified Calculus).
\end{definition}

\begin{definition}
	A $\Sigma$-\emph{Kripke structure} $\mathcal{K}$ is a partially ordered set $W$, called the Kripke \emph{frame}, and an indexed family of $\Sigma$-structures $(\mathcal{M}_w)_{w\in W}$ such that for $u\leq w$ we have $M_u\subseteq M_w$, $f^{I_w}|_{M_u} = f^{I_u}$ and $R^{I_w}|_{M_u} = R^{I_u}$.\footnote{Here $f|_M$ denotes the restriction of $f$ to $M$}
	The model relation between $\mathcal M_u$, $v$ (mapping into $M_u$) and formulas $\varphi$ is defined as before, except in the cases of implication and $\forall$-quantification, where we set
	\begin{itemize}
		\item $\mathcal M_u, v\models \varphi\to\psi$ iff for every $w\geq u$ we have $\mathcal M_w, v\not\models\varphi$ or $\mathcal M_w, v\models\psi$.
		\item $\mathcal M_u, v\models\forall x\varphi$ iff for every $w\geq u$ and $m\in M_w$ we have $\mathcal M_w, v[m/a]\models\varphi[a/x]$.
	\end{itemize}
	We write $u, v\models\varphi$ if $\mathcal M_u, v\models \varphi$. $\mathcal{K}$ satisfies $\varphi$ if $u, v\models\varphi$ holds for every world $u$ and variable assignment $v$. $\varphi$ is valid if it is satisfied by every Kripke structure.
	$\varphi$ is valid for some frame (write $W\models\varphi$) if it is satisfied in every Kripke structure with that frame. We denote the set of valid formulas with \emph{IQC} (Intuitionistic Quantified Calculus).
\end{definition}
In addition to propositional tautologies there are now quantified formulas which are classically valid but not intuitionistically, e.g., $\neg\forall x A(x)\to \exists x \neg A(x)$.

\subsection{Skolemization and Herbrandization}\label{section:herbrandiaztion}

An important step in the embedding will be the elimination of quantifiers via Herbrandization.
In this process we introduce fresh variables and add additional function symbols to the signature.
A fresh variable is any variable that does not occur in any of the considered formulas.
Whenever we add a function symbol we implicitly extend the signature by some not previously contained symbol.

\begin{definition}\label{definition:skolemization}
	For formulas $\varphi$ we define the Skolemization $\varphi^S_Z$ and Herbrandization $\varphi^H_Z$ with respect to a set of free variables $Z$ by simultaneous induction:
	\begin{itemize}
		\item $A^S_Z = A^H_Z = A$ for each atomic $A$.
		\item $(\varphi\circ\psi)^X_Z = \varphi^X_Z\circ\psi^X_Z$ for $\circ\in\{\wedge, \vee\}$, $X\in\{S, H\}$.
		\item $(\varphi\to\psi)^S_Z = \varphi^H_Z\to \psi^S_Z$ and $(\varphi\to\psi)^H_Z = \varphi^S_Z\to\psi^H_Z$.
		\item $(\forall x\varphi)^S_Z = \forall x(\varphi[a/x]^S_{Z\cup\{a\}}[x/a])$ where $a$ is a new free variable.\\$(\forall x\varphi)^H_Z = \varphi[s(z_1,\dots,z_n)/x]^H_Z$ where $s$ is a new function, $\{z_1\dots z_n\} = Z$.
		\item $(\exists x\varphi)^S_Z = \varphi[s(z_1,\dots,z_n)/x]^S_Z$ where $s$ is a new function, $\{z_1\dots z_n\} = Z$.\\$(\exists x\varphi)^H_Z = \exists x(\varphi[a/x]^H_{Z\cup\{a\}}[x/a])$ where $a$ is a new free variable.
	\end{itemize}
	Let $$\varphi^S = (\exists x_1\dots\exists x_n \varphi[x_1/a_1\dots x_n/a_n])^S_\emptyset$$ and $$\varphi^H = (\forall x_1\dots\forall x_n \varphi[x_1/a_1\dots x_n/a_n])^H_\emptyset$$ where $a_1,\dots,a_n$ are the free variables occurring in $\varphi$.
\end{definition}

\begin{theorem}
	\label{thm:herbrand-skolem}
	For every formula $\varphi$
	\begin{itemize}
		\item $\varphi$ and $\varphi^S$ are classically equisatisfiable.
		\item $\varphi$ and $\varphi^H$ are classically equivalid.
	\end{itemize}
\end{theorem}


\subsection{Intuitionistic normal forms}

Finally we note the results from~\cite{otten2005clausal} which are of importance to us.

\begin{lemma}\label{lemma:propositional-normal-form}
	For every propositional formula $\varphi$ there exists an atom $P$ as well as sets of clauses $\mathcal R, \mathcal X$, with $\mathcal R$ containing  \emph{flat clauses} of the form
	$$\bigwedge_iA_i\to\bigvee_jB_j$$
	and $\mathcal X$ containing \emph{implication clauses} of the form
	$$(A\to B)\to C,$$
	such that $\varphi$ is intuitionistically equivalid to
	$$\left(\bigwedge\mathcal R\wedge\bigwedge\mathcal X\right)\to P$$where $A_i, B_i, A, B, C$ are atomic. The size of $\mathcal R$ and $\mathcal X$ is linear in the size of $\varphi$. In general they will contain additional propositional variables.
\end{lemma}

A similar result holds in the first order case.

\begin{lemma}\label{lemma:first-order-normal-form}
	For every predicate formula $\varphi$ there exists a nullary predicate symbol $P$ as well as sets of clauses $\mathcal R,\mathcal X, \mathcal Q$, with $\mathcal R$ containing \emph{flat clauses} of the form
	$$\forall \vec x\left(\bigwedge_i A_i\to \bigvee_jB_j\right),$$
	$\mathcal X$ containing \emph{implication clauses} of the form
	$$\forall \vec x\left((A\to B)\to C\right)$$
	and $\mathcal Q$ containing \emph{quantification clauses} of the form
	$$\forall\vec x\left((\forall y A)\to B\right),$$
	such that $\varphi$ is intuitionistically equivalid to
	$$\left(\bigwedge\mathcal R\wedge\bigwedge \mathcal X\wedge\bigwedge\mathcal Q\right)\to P$$where $A_i, B_i, A, B, C$ are atomic. This size of $\mathcal R, \mathcal X, \mathcal Q$ is linear in the size of $\varphi$. In general this formula will contain new function and predicate symbols.
\end{lemma}

Since we could not find a proof of this, one is given in the appendix.

\section{Overview}
\label{sec:overview}

We shall now give an overview of our main results and highlight the key arguments. We start with the propositional case. The important insights are the same as in the first-order case, while it is technically simpler and less cluttered.

The general idea is to use the Kripke semantics for intuitionistic logic, which are expressed in classical logic, to perform an embedding of formulas. That is, for each formula $\varphi$ we give a formula $\varphi^\#$ that is classically valid if and only if $\varphi$ is intuitionistically valid, establishing a dual to the double negation translation.

The key property that allows us to reduce our encoding to propositional logic, which a priori targets first order logic, is a reduction of counter-models. In particular, given $$\varphi = \left(\bigwedge\mathcal R\wedge\mathcal X\right)\to P$$ as in Lemma~\ref{lemma:propositional-normal-form} we establish:

\begin{lemma}
	If $\varphi$ is intuitionistically invalid then there exists a Kripke counter-model which is a rooted tree with height and degree bounded by $|\mathcal X|$.
\end{lemma}

This allows us to embed intuitionistic propositional logic into classical propositional logic by replacing quantification over worlds by their enumeration.

\begin{lemma}
	For each propositional formula $\varphi$ there is effectively a formula $\varphi^\#$ with $\mathcal |\varphi^\#|\in\mathcal O(|\mathcal R|\cdot 2^{|\mathcal X|\log|\mathcal X|})$ such that $\varphi$ is intuitionistically valid if and only if $\varphi^\#$ is classically valid.
\end{lemma}

The exact details can be found in Theorem~\ref{thm:prop-translation}. Instead of expressing correctness at each world of the model, we can express that the worlds along some path in the tree are correct. The branching of paths can be expressed through quantification in a quantified boolean formula (QBF) which gives us the following:

\begin{lemma}
	For each propositional formula $\varphi$ there is effectively a QBF $\varphi^Q$ with $\mathcal |\varphi^Q|\in\mathcal O(|\mathcal R|\cdot|\mathcal X| + |\mathcal X|^3)$ such that $\varphi$ is intuitionistically invalid if and only if $\varphi^Q$ is a satisfiable QBF.
\end{lemma}

Again, the details can be found in Section~\ref{sec:qbf}. Next we attempt to transport these results to the first order case. However, there are formulas for which only counter-examples with an infinite Kripke frame exist. Therefore, there is no hope of completely eliminating terms representing worlds from the final embedding. This also means that our language necessarily becomes more complex. Still, a number of reductions is possible.

\begin{theorem}
	\label{thm:reduction-first-order-short}
	There exists a linear-time procedure that gives for every first-order formula $\varphi$ a formula $\varphi^\#$ such that $\varphi$ is intuitionistically valid if and only if $\varphi^\#$ is classically valid. The size of $\varphi^\#$ is in linear in the size of $\varphi$, however, for each $n$-ary predicate symbol in $\varphi$ there is a corresponding $n+1$-ary predicate symbol in $\varphi^\#$, and $\varphi$ contains a new binary predicate $E$ as well as a number of new function symbols. Furthermore, there is an effective translation between intuitionistic counter-models of $\varphi$ and classical counter-models of $\varphi^\#$.
\end{theorem}

A detailed account of the translation can be found in Definition~\ref{def:fo-translation}. Finally, we benchmark our translation by translating all problems in the ILTP problem set~\cite{iltp} and applying the Vampire theorem prover~\cite{kovacs2013first} to the translated instances. While this method falls short of the absolute state-of-the-art in general, for certain subsets of benchmarks it beats existing provers, in particular when the intuitionistic content is low. Since there is still a lot of room for improvement this is a hopeful first sign.


\section{Bounded Intuitionistic Counter-models}

The most obvious approach to embedding intuitionistic into classical logic is to examine intuitionistic semantics, e.g. Kripke frames, as a classical first order theory. For every propositional variable $A$ consider a unary predicate $A$ of the same name where $A(u)$ expresses that $A$ is true at some world $u$. We can then consider the following na√Øve encoding:

\begin{definition}
	Let $\varphi$ be a propositional formula. Define $\varphi^{\nu}$ inductively:
	\begin{itemize}
		\item $\bot^\nu = \bot$.
		\item $A^{\nu} = A(\nu)$ for every propositional variable $A$.
		\item $(\varphi\circ\psi)^\nu = \varphi^\nu\circ\psi^\nu$ for $\circ\in\{\wedge, \vee\}$.
		\item $(\varphi\to \psi)^\nu = \forall w(\nu\preceq w\to\varphi^{w}\to\psi^{w})$ where $w$ is some new bound variable.
	\end{itemize}
	Let $K(\varphi)$ encode the theory of Kripke structures, i.e.
	$$K(\varphi) = \text{\normalfont PartialOrder}(\preceq)\wedge\forall u\forall w(u\preceq w\to \text{\normalfont Persistent}(u, w))$$
	with e.g.
	\begin{align*}
		\text{\normalfont PartialOrder}(\preceq) =&\:\forall u(u\preceq u)\wedge\forall u\forall w(u\preceq w\to w\preceq u\to u = w)\wedge\\&\:\forall u\forall v\forall w(u\preceq v\to v\preceq w\to u\preceq w)\\
		\text{\normalfont Persistent}(u, w)=&\:\bigwedge \{A(u)\to A(w)\:|\: \text{ $A$ occurs in $\varphi$}\}
	\end{align*}
	Then define
	$$\varphi^{C} = K(\varphi)\to \varphi^{b}$$
	where $b$ is a new free variable.
\end{definition}

\noindent All we have done is model Kripke semantics as a first-order theory, so we obtain:

\begin{lemma}
	$\varphi$ is intuitionistically valid if and only if $\varphi^C$ is classically valid.
\end{lemma}

This is somewhat unsatisfying as we end up in a much more complex logic. However using the normal form from Lemma~\ref{lemma:propositional-normal-form}, i.e. assuming that $\varphi$ is of the form $$\left(\bigwedge\mathcal R\wedge\bigwedge\mathcal X\right)\to P$$ for some flat clauses $\mathcal R$ and implicational clauses $\mathcal X$, further simplification is possible:
\begin{itemize}
	\item For flat clauses $(\bigwedge A_i\to\bigvee B_j)^\nu$ is
	$$\forall w\left(\nu\preceq w\to\bigwedge_i A_i(w)\to\bigvee_jB_j(w)\right).$$
	\item For implication clauses $((A\to B)\to C)^\nu$ is
	$$\forall w(\nu\preceq w\to(\forall k(w\preceq k\to A(k)\to B(k)))\to C(w))$$
\end{itemize}

and after applying Herbrandization we end up with a formula $$\varphi^{CH} = K(\varphi)\to\left(\bigwedge\mathcal R^{b S}\wedge \bigwedge\mathcal X^{b S}\right)\to P(s)$$ where $s$ is a new constant symbol, each formula in $\mathcal R^{b S}$ is of the form
$$\forall w\left(s\preceq w\to\bigwedge_iA_i(w)\to\bigvee_jB_j(w)\right)$$
and each formula $\psi\in\mathcal X^{b S}$ is of the form
$$\forall w(s\preceq w\to(w\preceq f_\psi(w)\to A(f_\psi(w))\to B(f_\psi(w)))\to C(w))$$
with $f_\psi$ being a new function symbol.

We now argue that if a counter-model for $\varphi^{CH}$ exists then a small counter-model exists. This is ultimately what enables our translations.

\begin{definition}
For $\psi\in\mathcal X$ let $[\psi]$ denote the corresponding clause in $\mathcal X^{b S}$. Suppose we are given a counter-model $\mathcal M = (M, I)$ for $\varphi^{CH}$.
We say $(A\to B)\to C\in\mathcal X$ is \emph{fulfilled} at $m\in M$ iff $A^I(m)\to B^I(m)$ is false or $C^I(m)$ is true. For $\psi\in\mathcal X$ define $$g_\psi : M\to M, m\mapsto\begin{cases}
		m,&\text{ if $\psi$ is fulfilled at $m$,}\\
		f^I_{\lbrack\psi\rbrack}(m),&\text{ else.}		
	\end{cases}$$Define a model $\mathcal M_T = (M_T, I_T)$ as follows:
	\begin{itemize}
		\item $M_T$ is the set of sequences without repetition on $\mathcal X$.
		\item $s^{I_T} = \epsilon$.
		\item Interpret $\preceq$ as the prefix-order.
		\item We set $$f_\psi^{I_T}(\psi_1\dots\psi_n) = \begin{cases}
			\psi_1\dots\psi_n, &\text{if $\psi$ occurs in $[\psi_1]\dots[\psi_n]$,}\\
			\psi_1\dots\psi_n\psi, &\text{else.}			
		\end{cases}$$
		\item For propositional variables $P$, we set $$P^{I_T}\left(\psi_1\dots \psi_n\right) = P^I\left(g_{\psi_n}\left(\dots\left(g_{\psi_1}\left(s^I\right)\right)\dots\right)\right).$$
	\end{itemize}
\end{definition}
\begin{lemma}~\label{thm:prop-countermodel-reduction}
	Let $\mathcal M = (M, I)$ be a counter-model to $\mathcal \varphi^{CH}$.
	\begin{enumerate}
		\item $\psi$ is fulfilled at $f_{[\psi]}^I(u)$ for all $u\in M, \psi\in\mathcal X$.
		\item If $\psi$ is fulfilled at some $m\in M$ then $\psi$ is fulfilled at all $n\succeq^I m$.
	\end{enumerate}
\end{lemma}


\begin{proof}
	1. If $C^I(m)$ is true then we are done due to persistency. Otherwise $C^I(m)$ is false.
	Because $(A^I(f_{[\psi]}^I(m))\to B^I(f_{[\psi]}^I(m)))\to C^I(u)$ holds, then $A^I(f_{[\psi]}^I(u))\to B^I(f_{[\psi]}^I(u))$ must be false.
	
	
	2. Let $n\succeq^I m$.
	If $C^I(n)$ is true, we are done.
	Otherwise $C^I(n)$ is false.
	Due to persistency $C^I(m)$ is also false.
	Because $\psi$ is fulfilled at $m$, $A^I(m)\to B^I(m)$ must be false, i.e. $A^I(m)$ is true and $B^I(m)$ is false. Then $A^I(n)$ and $A^I(f^I_{[\psi]}(n))$ are also true due to persistency.
	Because $(A^I(f^I_{[\psi]}(n))\to B^I(f^I_{[\psi]}(n)))\to C^I(n)$ holds, we now get that  $B^I(f^I_{[\psi]}(n))$ must be false.
	But then due to persistency so is $B^I(n)$ and we have that $\psi$ is fulfilled at $n$.\hfill$\square$
\end{proof}

Essentially what this tells us is that for every $m$ at which $\psi$ is fulfilled, in particular for each $m$ in the image of $f_{[\psi]}$, we may add the assumption that $f_{[\psi]}(n) = n$ for all $n\succeq m$ without changing the validity of $\psi$. With this lemma in hand showing that $(M_T, I_T)$ is a counter-model to $\varphi^{CH}$ is a straightforward check of definitions.

\begin{corollary}\label{cor:prop-tree-model}
	If $\mathcal M$ is a counter-model to $\varphi^{CH}$ then so is $\mathcal M_T$.
\end{corollary}

\begin{remark}
	It is well known that Kripke frames which are trees are complete with regard to intuitionistic logic. Our contribution is giving an explicit bound to height and degree that depends only on a simple property of the considered formula.
\end{remark}

\begin{corollary}
	If a formula in normal form as in Lemma~\ref{lemma:propositional-normal-form} is intuitionistically invalid then there exists a Kripke counter-model which is a rooted tree with height and degree bounded by $|\mathcal X|$.
\end{corollary}

\section{IPC to CPC}

We can apply the previous results to give a direct embedding from intuitionistic into classical propositional logic. We know that $\varphi^{CH}$ is valid if and only if it is valid for structures that have as a domain the sequences without repetition over $\mathcal X$, ordered by the prefix-relation and $$s^I = \epsilon, f_\psi^I(x) = \begin{cases}
	x, &\text{ if $\psi$ occurs in $x$,}\\
	x\psi, &\text{ otherwise.}
\end{cases}$$
Now we can replace every $\forall$-quantifier in $\varphi^{CH}$ by enumerating all the ground terms, and then replace all distinct ground instances of relations by new propositional variables yielding a propositional formula. Note that the encoding of the partial order becomes redundant, so we drop it. We need to keep the persistency constraints. This gives us the following theorem:

\begin{theorem}\label{thm:prop-translation}
	Suppose we are given a formula as in Lemma~\ref{lemma:propositional-normal-form}, i.e. of the form
	$$\left(\bigwedge\mathcal R\wedge\bigwedge\mathcal S\right)\to P$$
	with flat $\mathcal R$ and implication $\mathcal S$. Let $\Lambda$ denote the set of sequences without repetition over $\mathcal X$. For every propositional variable $A$ and $\lambda\in\Lambda$ consider a new propositional Variable $A^\lambda$. Define $R^\#$ as the union over all sets
	$$
		\left\{\bigwedge_iA_i^\lambda\to\bigvee_jB_j^\lambda\:|\:\lambda\in\Lambda\right\}
	$$
	for $\bigwedge_iA_i\to\bigvee_jB_j\in\mathcal R$ and $\mathcal X^\#$ as the union over all sets
	$$
		\left\{\left(A^{\lambda\psi} \to A^{\lambda\psi}\right)\to C^\lambda\:|\:\lambda\in\Lambda, \psi\text{ does not occur in }\lambda\right\}
	$$
	for $\psi = (A\to B)\to C\in\mathcal X$ as well as $P^\#$ as the union over all sets
	$$
		\left\{A^\lambda\to A^{\lambda\psi}\:|\:\lambda\in\Lambda, \psi\text{ does not occur in }\lambda\right\}
	$$
	 for each propositional variable $A$ occurring in $\varphi$, encoding persistency. Then
	$$
		\varphi^\# := \left(\bigwedge P^\#\wedge\bigwedge \mathcal R^\#\wedge\bigwedge\mathcal X^\#\right)\to P^\epsilon
	$$
	is classically valid if and only if $\varphi$ is intuitionistically valid.
\end{theorem}
%\begin{theorem}
%	$\bigwedge\mathcal S\to P$ is intuitionistically valid iff $\bigwedge\mathcal S^\#\to P^\emptyset$ is classically valid.
%\end{theorem}

\begin{example}
	Let us consider the law of excluded middle $\varphi = A\vee\neg A$ for which there is the equivalid normal form
	$$((A\to P)\wedge ((A\to \bot)\to P))\to P.$$
	Applying the above lemma this is intuitionistically valid if and only if $$((A^\epsilon\to A^\psi)\wedge(P^\epsilon\to P^\psi)\wedge(A^\epsilon\to P^\epsilon)\wedge(A^\psi\to P^\psi)\wedge ((A^\psi\to \bot)\to P^\epsilon))\to P^\epsilon$$ is classically valid where $\psi := (A\to \bot)\to P$.
	We note that $A^\epsilon  = P^\epsilon = 0$, $A^\psi = P^{\psi}  = 1$ indeed defines a counter-model.
\end{example}	

\section{IPC to QBF}\label{sec:qbf}

It is known that a polynomial time translation between QBF and IPC must exist, since both problems are PSPACE complete~\cite{garey1979computers,statman1979intuitionistic}.
The translation from the last section will serve as starting point for developing the translation in this section.
For lack of space, we do not define the semantics of QBF in this paper and refer the reader to standard sources e.g.~\cite{series/faia/2009-185}.

Suppose we are given a formula $\varphi$ in normal form $$\left(\bigwedge\mathcal R\wedge\bigwedge\mathcal X\right)\to P$$ as in Lemma~\ref{lemma:propositional-normal-form}. We will now formulate a QBF that expresses that $\varphi$ has an intuitionistic counter-model. The idea how to get a polynomially-sized formula is: Instead of expressing validity at every node of $\mathcal M_T$ --- which was done in the CPC translation --- we express that on each path in $\mathcal M_T$ the nodes satisfy all conditions for $\mathcal M_T$ being a counter-model. The universally quantified variables $X_\psi$ in the next definition handle the branching, i.e. express which path is considered.

\begin{definition}
	For every propositional variable $A$ occurring in $\varphi$ and non-negative integer $n$ consider a new propositional variable $A^n$ and for every formula $\psi\in\mathcal X$ consider a new propositional variable $X_\psi^n$. Let $\vec A^n$ range over all propositional variables $A^n$ and $\vec X^n$ range over all $X_\psi^n$. Define
	\begin{itemize}
		\item {\normalfont Valid}$(n)$ which encodes that $\vec X^n_\psi$ represents a valid next element of a sequence without repetition, i.e. if we interpret the $\vec X^i$ as bit-vectors, then $\vec X^n$ has exactly one bit set to $1$, indicating the formula at the $n$-th position of the sequence, and it is at a position that is $0$ in $\sum\{\vec X^i\:|\:i < n\}$.
		\item {\normalfont Persistent}$(n)$ which encodes that the persistency condition holds.
		\item {\normalfont Sat}$_{\mathcal R}(n)$ encoding that the formulas in $\mathcal R$ hold at the $n$-th world of the path.
		\item {\normalfont Sat}$_{\mathcal X}(n)$ encoding that the formula in $\mathcal X$ that is represented by $\vec X^{n-1}$ holds.
	\end{itemize}
	Define$$\varphi^Q_{i} = \exists \vec A^i\forall \vec X^i\left(\text{\normalfont Persistent}(i)\wedge \text{\normalfont Sat}_{\mathcal R}(i)\wedge \text{\normalfont Sat}_{\mathcal X}(i)\wedge\left(\text{\normalfont Valid}(i)\to \varphi^Q_{i+1}\right)\right)$$
	for $0 < i < |\mathcal{X}|$, as well as the special cases
	$$\varphi^Q_{|\mathcal{X}|} = \exists \vec A^{|\mathcal{X}|}\left(\text{\normalfont Persistent}(|\mathcal{X}|)\wedge \text{\normalfont Sat}_{\mathcal R}(|\mathcal{X}|)\wedge \text{\normalfont Sat}_{\mathcal X}(|\mathcal{X}|)\right)$$
	for leaves, and $$\varphi^Q = \varphi_0^Q = \exists \vec A^0\forall \vec X^0\left(\neg P^0\wedge \text{\normalfont Sat}_{\mathcal R}(0)\wedge(\text{\normalfont Valid}(0)\to \varphi_1^Q)\right)$$for the root.
	Example encodings of the above formulas are:
	\begin{align*}
		\text{\normalfont Valid}(n) = &\left(\bigvee\left\{X^n_\psi\:|\:\psi\in\mathcal X\right\}\right)\wedge\left(\bigwedge \left\{\neg(X^n_{\psi_1}\wedge X^n_{\psi_2})\:|\:\psi_1\neq\psi_2\in\mathcal X\right\}\right)\wedge\\&\left(\bigwedge\left\{\bigwedge\{X^i_\psi\to\neg X^n_\psi\:|\:i < n\}\:|\:\psi\in\mathcal X\right\}\right)\\
		\text{\normalfont Persistent}(n) = & \bigwedge\left\{A^{n-1}\to A^n\:|\: A \text{ prop. variable with }A^{n-1}\in\vec A^{n-1}, A^n \in\vec A^{n}\right\}\\
		\text{\normalfont Sat}_{\mathcal R}(n) = &\bigwedge\left\{\bigwedge A^n_i\to\bigvee B^n_j\:|\:\bigwedge A_i\to\bigvee B_j\mathcal R\right\}\\
		\text{\normalfont Sat}_{\mathcal X}(n) = & \bigwedge\left\{X^{n-1}_\psi\to (A^n\to B^n)\to C^{n-1}\:|\:\psi = (A\to B)\to C\in\mathcal X\right\}
	\end{align*}
\end{definition}

\begin{example}
	With the previous encoding for double negation elimination $\varphi = ((A\to \bot)\to \bot)\to A$ we have
	$$\hspace*{-.3cm}
	\varphi^Q = \exists A^0\forall X^0\left(\neg A^0\wedge\left(X^0\to \exists A^1\left((A^0\to A^1)\wedge(X_0\to (A^1\to \bot)\to \bot)\right)\right)\right),
	$$
	which is a satisfiable QBF since $A^0 = 0, A^1 = 1$ satisfies it for any choice of $X^0$.
\end{example}


\begin{lemma}
	$\varphi$ is not intuitionistically valid if and only if $\varphi^Q$ is a satisfiable QBF.
\end{lemma}
A proof can be found in the appendix as Lemma~\ref{lemma:QBF}.

A simple counting argument shows that for each $n < |\mathcal X|$ we have $|\text{Valid}(n)|\in \mathcal O(|\mathcal X|^2)$, $|\text{Persistent}(n)|, |\text{Sat}_{\mathcal R}(n)|\in \mathcal O(|\mathcal R|)$ and $|\text{Sat}_{\mathcal X}(n)|\in \mathcal O(|\mathcal X|)$ so overall we get:
\begin{lemma}
	The size of $\varphi^Q$ is in $\mathcal O(|\mathcal R|\cdot|\mathcal X| + |\mathcal X|^3)$.
\end{lemma}

Note that the last set of universally quantified variables can be avoided because there is only one assignment that has the chance to falsify $\varphi^Q$, namely the assignment that assigns $1$ to the single $X_\psi^n$ such that $X_\psi^i = 0$ for all $i < n$. Hence, in our final formula we can replace every $X_\psi^n$ with $\bigwedge\{\neg X_\psi^i\:|\:i < n\}$ and remove that quantification over $X_\psi^n$. With that we get the following:

\begin{corollary}
	Let $N$-\textbf{IntInvalid} be the problem of deciding if a formula $(\bigwedge \mathcal R\wedge\bigwedge\mathcal X)\to P$ as in Lemma~\ref{lemma:propositional-normal-form} with $|\mathcal X|\leq N$ is not intuitionistically valid. Then $N$-\textbf{IntInvalid} is in $\Sigma_{2N-1}^P$. The dual problem $N$-\textbf{IntValid} is in $\Pi_{2N-1}^P$.
\end{corollary}


\section{CQC to IQC}

We now give an analogous transformation for first order logic. Our trick of lifting the sentence to first-order logic to encode the Kripke semantics no longer works in such a straightforward manner, since we already are in first-order logic. However we do it nonetheless! The domain of our classical model will feature on the one hand elements representing worlds in a Kripke frame and on the other hand the domain-elements from the Kripke model. We reconcile these notions by introducing a special binary predicate $E$, first considered in~\cite{baaz2006skolemization} and expanded onto in~\cite{iemhoff2010eskolemization}, where $E(x, u)$ encodes that $x$ is an element of the domain of the world $u$. To encode that some $n$-ary predicate $A$ holds at a world $u$ we extend each $n$-ary predicate symbol to a $n+1$-ary predicate symbol of the same name, interpreting $A(\vec x, u)$ as "$A(\vec x)$ holds at u". Furthermore we write $\vec E(\vec x, u)$ for $\bigwedge\{E(x_i, u)\:|\:x_i\in \vec x\}$. With this we obtain the following encoding of Kripke Semantics:

\begin{definition}\label{def:fo-translation}
	Let $\varphi$ be a predicate formula. Define $\varphi^{\nu}$ inductively:
	\begin{itemize}
		\item $\bot^\nu = \bot$.
		\item $A(\vec t)^{\nu} = A(\vec t, \nu)$ for every predicate symbol $A$.
		\item $(\varphi\circ\psi)^\nu = \varphi^\nu\circ\psi^u$ for $\circ\in\{\wedge, \vee\}$.
		\item $(\varphi\to \psi)^\nu = \forall w(\nu\preceq w\to\varphi^{w}\to\psi^{w})$.
		\item $(\exists x\varphi)^\nu = \exists x(E(x,\nu)\wedge\varphi[a/x]^\nu[x/a])$ where $a$ is a new free variable.
		\item $(\forall x\varphi)^\nu = \forall w(i\preceq w\to \forall x(E(x, w)\to \varphi[a/x]^w[x/a]))$ where $a$ is a new free variable and $w$ is a new bound variable.
	\end{itemize}
	where $w$ is some new bound variable. Let $K(\varphi)$ encode the theory of Kripke structures as well as the predicate $E$, i.e.
	\begin{align*}
		K(\varphi) = \:& \text{PartialOrder}(\preceq) \wedge \forall u \forall w (u\preceq w\to \text{DomainSubset}(u, w)) \wedge\\
		& \forall u(\text{World(u)}\to \text{DomainClosed}(u))\wedge \forall u\forall w (u\preceq w\to \text{Persistent}(u, w)).
	\end{align*}
	with e.g.:
	\begin{align*}
		\text{PartialOrder}(\preceq) = &\:\forall u(u\preceq u)\wedge\forall u\forall w(u\preceq w\to w\preceq u\to u = w)\wedge\\&\:\forall u\forall v\forall w(u\preceq v\to v\preceq w\to u\preceq w)\\
		\text{DomainSubset}(u, w) = &\:\forall x(E(x, u)\to E(x, w))\\
		\text{World}(u) = &\:\exists xE(x, u)\\
		\text{DomainClosed}(u) = &\:\bigwedge\left\{\forall\vec x(\vec E(\vec x, u)\to E(f(\vec x), u))\:|\:\text{$f$ a function in $\varphi$}\right\}\\
		\text{Persistent}(u, w) = &\:\bigwedge\left\{\forall\vec x(\vec A(\vec x, u)\to A(\vec x, w))\:|\:\text{$A$ a predicate in $\varphi$}\right\}
	\end{align*}
	Then define
	$$\varphi^C = K(\varphi)\to\text{World}(b)\to \vec E(\vec a, b)\to \varphi^b$$where $\vec a$ contains all free variables occurring in $\varphi$ and $b$ is a new free variable.
\end{definition}

\begin{lemma}\label{lemma:fo-simplification}
	$\varphi$ is intuitionistically valid if and only if $\varphi^C$ is classically valid.
\end{lemma}

\begin{proof}
	Since we are mixing worlds and proper intuitionistic domain elements in a single classical domain there are some details to be taken care of. We proceed by translation of counter-models.
	
	Suppose first we have a counter-model $\mathcal M = (M, I)$ to $\varphi^C$. As a Kripke frame $(W, \leq)$ take $ W = \{m\in M\:|\:\text{ World}^I(m)\}$ and let $\leq$ be $\preceq^I$ restricted to $W$. Then let $M_u = \{m\in M\:|\: E(m, u)\}$ and let $f^{I_u}$ be $f^I$ restricted to $M_u$ and $A^{I_u}(\vec x): \Leftrightarrow A(\vec x, u)$. It is then a straightforward check of definitions that this defines a Kripke counter-model to $\varphi$.
	
	The other direction is a bit more involved. Suppose we have a Kripke counter-model to $\varphi$ with frame $(W, \preceq)$ and family of $\Sigma$-structures $(M_w, I_w)_{w\in W}$. In particular, since it is a counter-model there exists $w_0\in W$ and a variable assignment $v$ with $w_0, v\not\models\varphi$. Let $W_0 = \{w\in W\:|\: w_0\preceq w\}$ and define an equivalence relation $\sim$ on $\{(x, u)\:|\:u\in W_0, x\in M_u\}$ via $(x, u)\sim (y, w)$ iff $x = y$ and there exists $v\in W_0$ comparable with both $u, w$ such that $x\in v$ and denote the equivalence class of $(x, u)$ with $[x, u]$. Let $M = W_0\cup \{[x, u]\:|\:u\in W_0, x\in M_u\}$.
	Now have
	\begin{itemize}
		\item $\preceq^I = \leq\cup \{(m, m): m\in M\setminus W_0\}$ as a set, i.e. $\preceq$ corresponds to $\leq$ on $W_0$ and is trivial elsewhere.
		\item $E^I(m, w)$ iff $w\in W_0$ and $m = [x, w]$ for some $x\in M_w$.
		\item $f^I(m_1\dots m_n) =\begin{cases}
			f^{I_u}(x_1\dots x_n), &\substack{\text{if there are $ u\in W_0, x_i\in M_u$}\\ \text{with $m_i= [x_i, u]$ for all $i$,}}\\
			w_0, & \text{otherwise.}
		\end{cases}$
		\item ${A}^I(m_1\dots m_n, u) \Leftrightarrow\begin{cases}
			A^{I_u}(x_1\dots x_n), &\substack{\text{if $u\in W_0$ and $\exists x_i\in M_u$}\\\text{with $m_i= [x_i, u]$ for all $i$,}}\\
			\bot, & \text{otherwise.}
		\end{cases}$
	\end{itemize}
	One easily verifies that these are well-defined. We now show by induction on the height of the formula the following:
	
	\emph{Claim.} For any formula $\psi$ in which the free variable $b$ doesn't occur, world $w_k\in W_0$ and variable assignments $v_c, v_i$ such that $v_c(a) = [v_k(a), w_k]$ for all free variables $a$ occurring in $\psi$ it holds that \[M, I, v_c[w_k/b]\models \psi^b\text{ if and only if $w_k, v_i\models \psi$.}\]
	
	For the base case, i.e. if $\psi = P(t_1,\dots, t_n)$ for some $n$-ary predicate symbol $P$, the claim follows directly from the definitions.
	
	For the induction step consider e.g. the case where $\psi$ is of the form $\forall x \psi'$.
	Suppose first that $w_k, v_i\not\models \forall x\psi'$, i.e. there exists $w_l\geq w_k$ and $m_l\in w_l$ such that $w_l, v_i[m_l/a]\not\models \psi'[a/x]$. Then by the induction hypothesis $M, I, v_c[[v_i(a), w_l],w_l/c]\not\models \psi'[a/x]^c$. Furthermore by definition $M, I, v_c[w_l/c, w_k/b]\models b\preceq c$ and $M, I, v_c[v_c[[v_i(a), w_l],w_l/c]\models E(a, c)$. Hence $M, I, v_c[w_k/b]\not\models \psi^b$. Suppose on the other hand that $w_k, v_i\not\models\forall x\psi'$, i.e. for all $w_l\geq w_k$ and $m_l\in w_l$ it holds that $w_l, v_i[m_l/a]\models \psi'[a/x]$. Then by the induction hypothesis $M, I, v_c[[m_l, w_l]/A,w_l/c]\models \psi'[a/x]^c$ for all $w_l\geq w_k$ and $m_l\in w_l$. It can be shown that for every other assignment of $c$ and $a$ either $b\preceq c$ or $E(a, c)$ is violated. Hence $M, I, v_c[w_k/b]\models \psi^b$. For other forms of $\psi$ one proceeds in similar fashion. This completes the proof of the claim.

	Recall that $w_0, v\not\models\varphi$. From the claim it follows that \[M, I, v'[[v(a_0), w_0]/a_0\dots[v(a_n), w_0]/a_0, w_0/b]\not\models \varphi^b\]where $a_0\dots a_n$ are the free variables occurring in $\varphi$ and $v'$ is any variable assignment. Furthermore a straightforward check of definitions yields \[M, I, v'[[v(a_0), w_0]/a_0\dots[v(a_n), w_0]/a_0, w_0/b]\models K(\varphi)\wedge \text{World}(b)\wedge\vec E(\vec a, b).\]Therefore $M, I\not\models \varphi^C$ and we are done. 

\end{proof}



Now again due to Lemma~\ref{lemma:first-order-normal-form} it is sufficient to consider formulas $\varphi$ of the form $$\left(\bigwedge\mathcal R\wedge\bigwedge\mathcal X\wedge\bigwedge\mathcal Q\right)\to P$$ with flat clauses $\mathcal R$, implication clauses $\mathcal X$ and quantification clauses $\mathcal Q$, which after Herbrandization leaves us with $$\varphi^{CH} = \text{World}(s)\to K(\varphi)\to\left(\bigwedge R^{bS}\wedge \bigwedge X^{bS}\wedge\bigwedge Q^{bS}\right)\to P(s)$$
where $s$ is a new constant symbol, each formula in $\mathcal R^{bS}$ is of the form
$$\forall w \forall \vec x(s\preceq w\to\vec E(x, w)\to\bigwedge_i A_i(\vec a_i, u)\to\bigvee_j B_j(\vec b_j, u)),$$
each formula $\psi\in\mathcal X^{bS}$ is of the form
$$
	\resizebox{\hsize}{!}{$\forall w\forall\vec x(s\preceq w\to\vec E(\vec x, w)\to (w\preceq f_\psi(\vec x, w)\to A(\vec a, f_\psi(\vec x, w))\to B(\vec b, f_\psi(\vec x, w)))\to C(\vec c, w))$}
$$
and each formula $\psi\in\mathcal Q^{bS}$ is of the form
$$\forall w\forall\vec x(s\preceq w\to\vec E(\vec x, w)\to \forall y(E(y, f_\psi(\vec x, w))\to A(\vec a, f_\psi(\vec x, w)))\to B(\vec B, w))$$
with $f_\psi$ being a new function symbol.

As in the previous section we can define a tree counter-model for this.
\begin{definition}
	Suppose we are given a counter-model $\mathcal M = (M, I)$ for $\varphi^{CH}$. Define $\mathcal M_T = (M_T, I_T)$ as follows:
	\begin{itemize}
		\item $M_T$ are the sequences on $\{(\vec m, \psi)\:|\:\psi\in \mathcal F, \vec m\in M^n\}$.
		\item $r^{I_T} = s^{I_T} = \epsilon$.
		\item We interpret $\preceq$ as the prefix-order.
		\item We set $$f_\psi^{I_T}(\vec m, (\vec m_1, \psi_1)\dots (\vec m_n, \psi_n)) = (\vec m_1, \psi_1)\dots (\vec m_n, \psi_n)(\vec m, \psi).$$
		\item For predicate symbols $R$, we set $${R}^{I_T}(\vec m, (\vec m_1, \psi_1)\dots (\vec m_n, \psi_n)) = {R}^I(\vec m, f_{\psi_n}(\vec m_n, \dots(f_{\psi_1}(\vec m_1, s^I))\dots)).$$
	\end{itemize}
\end{definition}

\begin{lemma}
	If $\mathcal M$ is a counter-model to $\varphi^{CH}$ then so is $\mathcal M_T$.
\end{lemma}

Even if we don't have the finiteness property of the propositional case, we have still managed to reduce the complexity of possible counter-models because we know that considering worlds of the form $$f_{\psi_1}(\vec m_1, f_{\psi_2}(\vec m_2, \dots f_{\psi_n}(\vec m_n, s)\dots))$$ is sufficient.
In particular, this allows us to completely eliminate $\preceq$, that is we remove the PartialOrder$(\preceq)$
from $K(\varphi)$ and adjust DomainSubset$(u, w)$ and Persistent$(u, w)$, e.g. remove quantification over $w$ and the precondition $u\preceq w$ from $K(\varphi)$ and replace DomainSubset$(u, w)$ with
$$
	\bigwedge\{\forall u\forall x\forall\vec y(E(x, u)\to E(x, f_\psi(\vec y, u)))\:|\:\psi\in\mathcal X\cup\mathcal Q\}
$$
and Persistent$(u, w)$ with
$$
	\bigwedge\{\forall\vec x\forall\vec y\forall u(A(\vec x, u)\to A(\vec x, f_\psi(\vec y, u)))\:|\:\psi\in\mathcal X\cup\mathcal Q, \text{$A$ a predicate in $\varphi$}\}.
$$Putting all of this together yields the following translation:
\begin{theorem}\label{thm:fo-translation}
	Let $\mathcal R,\mathcal X,\mathcal Q$ be as above. For every $n$-ary predicate $A$ define a new $n+1$-ary predicate of the same name. For every $\psi\in\mathcal \mathcal X\cup\mathcal Q$ define a new function symbol $f_\psi$. Consider a new binary predicate symbol $E$ and define $\vec E(\vec x, u) := \bigwedge\{E(x, u)\:|\:x\in\vec x\}$. Obtain $\mathcal R^\#$ by including
	$$
		\forall u\forall \vec x\left(\vec E(\vec x, u)\to\bigwedge_i A_i(\vec a_i, u)\to\bigvee_j B_j(\vec b_j, u)\right)
	$$
 	for each flat clause
 	$$
 		\forall \vec x\left(\bigwedge_i A_i(\vec a_i)\to\bigvee_j B_j(\vec b_j)\right)\in\mathcal R,
 	$$
 	$\mathcal X^\#$ by including
 	$$
 		\forall u\forall \vec x\left(A(\vec a, f_\psi(\vec x, u))\to B(\vec b, f_\psi(\vec x, u))\to C(\vec c, u)\right)
 	$$
 	for each implication clause
	$$
		\psi = \forall \vec x\left(\left(A(\vec a)\to B(\vec b)\right)\to C(\vec c)\right)\in\mathcal X,
	$$
	and $\mathcal Q^\#$ by including
	$$
		\forall u\forall \vec x\left(\forall y\left(A(\vec a, f_\psi(\vec x, u))\right)\to B(\vec b, u)\right)
	$$
	for each implication clause
	$$
		\psi = \forall \vec x\left(\forall y\left(A(\vec a)\right)\to B(\vec b)\right)\in\mathcal X.
	$$
	Then $\varphi$ is intuitionistically valid if and only if
	$$
		\varphi^\# := \exists xE(x, s)\to K(\varphi)\to \left(\bigwedge\mathcal R^\#\wedge\bigwedge\mathcal X^\#\wedge\bigwedge\mathcal Q^\#\right)\to P^\#(s)
	$$
	is classically valid, where $s$ is a new constant symbol and
	\begin{align*}
		K(\varphi) := &\:\bigwedge\left\{\forall\vec z\forall x\forall u((E(x, u)\to E(x, f_\psi(\vec z, u)))\:|\:\psi\in\mathcal X\cup\mathcal Q\right\}\wedge\\
		&\:\forall u\left(\exists xE(x, u)\to \bigwedge\{\forall\vec z(\vec E(\vec z, u)\to E(f(\vec z), u))\:|\:\text{$f$ a function in $\varphi$}\}\right)\wedge\\
		&\resizebox{.9\hsize}{!}{$\:\bigwedge\left\{\forall\vec z_1\forall \vec z_2\forall u(A(\vec z_1, u)\to A(\vec z_1, f_\psi(\vec z_2, u)))\:|\:\text{$\psi\in\mathcal X\cup\mathcal Q$, $A$ a predicate in $\varphi$}\right\}$.}
	\end{align*}
	The size of the obtained formula is linear in the input. However $|\mathcal X| + |\mathcal Q| + 1$ new function symbols and the new binary predicate $E$ were introduced and each $n$-ary predicate has been extended to a $n+1$-ary predicate.
\end{theorem}


\begin{wrapfigure}[8]{r}{0.4\textwidth}
	\vspace*{-.5cm}
	\begin{tabular}{l|c|c}
		Embedding&571&21.4\%\\
		Embedding (idem.)&557&20.9\%\\
		ileanCoP 1.2&875&32.8\%\\
		nanoCoP-i 2.0&858&32.1\%\\\hline
		Total&2669&100\%
	\end{tabular}
	\caption{Solved problems.}
	\label{fig:a}
\end{wrapfigure}

It is not possible to completely eliminate worlds from the domain by enumerating them since there are formulas with no finite counter-examples. An analogous procedure to the propositional case fails, however we can still retrieve additional axioms that restrict the interpretation of functions. That is, we may assume that $f_\psi(\vec t, w) = w$, if $\exists u(w = f_\psi(\vec t, u))$ for all $\psi\in\mathcal X\cup\mathcal Q$ (i.e. that $f_\psi$ parametrized by $\vec t$ is idempotent), and $f_\psi(\vec t, w) = w$, if $\exists u(w \geq f_\psi(\vec t, u))$ for all $\psi\in\mathcal X$ (which is even stronger than idempotence).

\section{Experimental Evaluation}
\label{sec:evaluation}


\begin{wrapfigure}[13]{r}{0.4\textwidth}
	\vspace*{4.9cm}
	\hspace*{1cm}
	\begin{tikzpicture}
		\begin{scope}[opacity=0.1, blend mode=multiply]
			\def\firstcircle{(90:.75) circle (1.5)}
			\def\secondcircle{(210:.75) circle (1.5)}
			\def\thirdcircle{(330:.75) circle (1.5)}
			\begin{tikzpicture}
				\begin{scope}[shift={(3cm,-5cm)}, fill opacity=0.5]
					\fill[red] \firstcircle;
					\fill[green] \secondcircle;
					\fill[blue] \thirdcircle;
					\draw node {$491$};
					\draw node at (30:1.2) {$30$};
					\draw node at (150:1.2) {$42$};
					\draw node at (270:1.2) {$22$};
					\draw node at (90:1.8) {$8$};
					\draw node at (210:1.8) {$2$};
					\draw node at (330:1.8) {$417$};
				\end{scope}
			\end{tikzpicture}
		\end{scope}
	\end{tikzpicture}
	\vspace*{-7.1cm}
	\caption{Instances proven by combinations of Embedding (red), Embedding (idem.) (green), ileanCoP or nanoCoP (blue)}
	\label{fig:c}
\end{wrapfigure}

We have benchmarked our first-order translation on version 1.1.2 of the ILTP problem set~\cite{iltp} by performing our translation and then examining the generated classical problem using Vampire~\cite{kovacs2013first}. 
For comparison the state-of-the-art intuitionistic provers ileanCoP 1.2~\cite{otten2008leancop} and nanoCoP-i 2.0~\cite{otten2021nanocop} were used. All benchmarks were conducted on an Intel Core i5-8400 2.80GHz machine running Linux with a time limit of 10s per problem. The problem \textsc{SYN007+1} was removed as our normal form procedure would explode the size of instance.

Two versions of the translation were tested, one with and one without the additional axioms encoding idempotence. The results are stated in Figure \ref{fig:a}. 
In general, our approach falls short of the state of the art. 
However when grouping the benchmarks by $|\mathcal Q|$ and $|\mathcal X|$, see Figure~\ref{fig:b},
we observe good performance of our approach for $|\mathcal Q| = 0$ and $|\mathcal X| \leq 2$ resp. $|\mathcal X| \geq 6$.
Figure~\ref{fig:c} shows that our approach solved 52 problems not solved by the state-of-the-art provers. Notably, while there is big overlap in solved instances, ileanCoP and nanoCoP also have a significant symmetric difference.\pagebreak
\begin{figure}
	\centering
	\begin{tabular}{c|c|lr|lr|lr|lr|c}
		$|\mathcal Q|$&$|\mathcal X|$&\multicolumn{2}{c}{Embedding}&\multicolumn{2}{c}{Embedding (idem.)}&\multicolumn{2}{c}{ileanCoP}&\multicolumn{2}{c}{nanoCoP-i 2.0}&Total\\\hline
		0&0		&157&88.2\%	&157&88.2\%		&128&71.9\%		&61&38.1\%	&178\\
		0&1-2	&119&29.8\%&130&32.5\%		&108&27.0\%		&96&24.0\%	&400\\
		0&3-5	&16&15.2\%	&17&16.2\%		&50&47.6\%		&40&28.1\%	&105\\
		0&6+	&27&38.6\%	&11&15.7\%		&20&28.6\%		&11&15.7\%	&70\\
		1-2&0-2	&84&29.3\%	&81&28.2\%		&227&79.1\%		&221&77.0\%	&287\\
		1-2&3-5	&80&25.6\%	&77&24.7\%		&141&45.2\%		&122&39.1\%	&312\\
		1-2&6+	&22&21.8\%	&21&20.8\%		&39&38.6\%		&37&36.6\%	&101\\
		3-5&0-5	&38&17.0\%	&40&17.9\%		&125&55.8\%		&110&49.1\%	&224\\
		3-5&6+  &20&8.4\%	&18&7.6\%		&64&27.0\%		&86&36.3\%	&237\\
		6+&0+	&8&1.1\%	&5&0.7\%		&73&9.7\%		&74&9.8\%	&755
	\end{tabular}
	\caption{Solved problems grouped by $|\mathcal Q|$ and $|\mathcal X|$.}
	\label{fig:b}
\end{figure}
\vspace*{-.5cm}

We conclude that our approach already has merits when $|\mathcal Q| = 0$ and $|\mathcal X|$ is small. 
We see that encoding idempotence does help to solve some additional benchmarks, but in general does not improve performance.
However, idempotence is a quite powerful concept from a model-theoretic perspective. We suspect that a more clever encoding of this property could improve our results. There are other restrictions on models we could consider, based on structural properties of the formula, e.g. the relation between occurrences of different atoms.

\section{Conclusion}

We have presented embeddings of intuitionistic into classical logic for the propositional and the predicate case. Using Kripke semantics and model reduction we have established that the complexity overhead of intuitionistic logic over classical logic can be parametrized by $|\mathcal X|$ and $|\mathcal Q|$. This is directly reflected in the exponential blow-up parametrized by $|\mathcal X|$ in the propositional case and more indirectly in our benchmarks in the predicate case.

A key motivation for our work has been the potential of using classical provers for intuitionistic proofs. Our tests have shown that there are cases where this is already reasonable.
However, the current complexity considerations are direct consequences of our straightforward constructions. We plan to establish better bounds in future work by utilizing structural properties of the input formula, in particular relations between different atoms. We hope that this will allow the construction of smaller counter-examples $\mathcal M_T$ and the use of redundant axioms to limit search in a more clever way.

On the theoretical side, we also hope to give a new translation from QBF to IPC that improves our understanding of the relationship between intuitionistic propositional logic and the polynomial hierarchy.
Finally, we plan to complement the counter-model translation presented in this paper by a proof translation.
We will target the particular calculi used by state-of-the-art provers, e.g. superposition in the case of Vampire. Ultimately we hope that this will also open a new path for program extraction via the Curry--Howard Correspondence.

\bibliographystyle{plain}
\bibliography{bibliography}

\appendix

\section{Omitted proofs}

\begin{lemma}\label{proof:first-order-normal-form}
	For every predicate formula $\varphi$ there exists a nullary relation symbol $P$ as well as sets of clauses $\mathcal R$ of the form
	$$\forall \vec x\left(\bigwedge_i A_i\to \bigvee_j B_j\right)$$
	called \emph{flat} clauses and $\mathcal X$ of the form
	$$\forall \vec x\left((A\to B)\to C\right)$$
	called \emph{implication} clauses as well as $\mathcal Q$ of the form
	$$\forall\vec x\left((\forall y A)\to B\right)$$
	called \emph{quantification} clauses such that $\varphi$ is intuitionistically equivalid to
	$$\left(\bigwedge\mathcal R\wedge\bigwedge \mathcal X\wedge\bigwedge\mathcal Q\right)\to P$$where $A_i, B_i, A, B, C$ are atomic. This size of $\mathcal R, \mathcal X, \mathcal Q$ is linear in the size of $\varphi$. In general this formula will contain new function symbols and predicate symbols.
\end{lemma}

\begin{proof}
	As in~\cite{otten2005clausal} we may assume that $\varphi$ is of the form $\psi\to P$. Recall that the transformation works by transforming $\psi$ into a set of equivalent assumptions $\left\lbrack \psi\right\rbrack$ of the desired form. We extend the given procedure with rules for quantifiers as follows:
	\begin{align*}
		\left\lbrack(\forall x \psi)\to A\right\rbrack&:= \left\lbrack\psi[s(\vec z)/x]\to A\right\rbrack\\
		\left\lbrack A\to (\forall x\psi)\right\rbrack&:= \{\forall x\chi[x/a]\:|\:\chi\in\left\lbrack A\to\psi[a/x]\right\rbrack\}\\
		\left\lbrack(\exists x\psi)\to A\right\rbrack&:= \{\forall x\chi[x/a]\:|\:\chi\in\left\lbrack A\to\psi[a/x]\right\rbrack\}\\
		A\to (\exists x\psi)&:= \left\lbrack A\to\psi[s(\vec z)/x]\right\rbrack
	\end{align*}
	where $s$ is a new function symbol, $a$ is a new free variable and $\vec z$ ranges over the free variables in $\psi$.
	While the generated set of clauses is in general not equivalent to $\psi$, section~\ref{section:herbrandiaztion} guarantees that it is at least equivalid.\hfill$\square$
\end{proof}


\begin{lemma}\label{lemma:QBF}
	$\varphi$ is not intuitionistically valid iff $\varphi^Q$ is a satisfiable QBF.
\end{lemma}
\begin{proof}
Suppose $\varphi$ is not intuitionistically valid.
Then, $(\bigwedge\mathcal R\wedge\bigwedge\mathcal X)\to P$ has an intuitionistic counter-model. By the previous section there exists a classical counter-model $\mathcal M$ for $(\bigwedge\mathcal R^\#\wedge\bigwedge\mathcal X^\#)\to P^\epsilon$.
We now define a QBF model iteratively.
For each atom $A$ interpret $A^0$ such as $\mathcal M$ interprets $A^\epsilon$. Suppose we are given interpretations of all atoms $A^i$ for $i < n$ and a sequence with no repetitions $\psi_1\dots\psi_{n-1}$ over $\mathcal X$ such that $\psi_i$ is exactly the $\psi\in\mathcal X$ for which $X_{\psi}^i$ is true and $A^i$ is interpreted as $A^{\psi_1\dots\psi_i}$  in $\mathcal M$.
Let the $X^{n}_\psi$ be arbitrarily interpreted (since they are $\forall$-quantified). If not exactly one of the $X^{n}_\psi$ is interpreted as true, then valid$(n)$ fails and the remaining propositions can be chosen arbitrarily. If $X^i_{\psi_n} = 1$ for some $i < n$, then valid$(n)$ also fails and the remaining propositions can be chosen arbitrarily.
So we may assume that $\psi_1\dots\psi_n$ is a sequence with no repetitions.
Interpret the atoms $A^n$ as $\mathcal M$ interprets $A^{\psi_1\dots\psi_n}$.
Continue this construction until $n  = |\mathcal X|$. Then from $\mathcal M$ being a counter-example to $(\bigwedge\mathcal R^\#\wedge\bigwedge\mathcal X^\#)\to P^\epsilon$ it directly follows that this interpretation satisfies $\varphi^Q$.
	
On the other hand suppose $\varphi^Q$ is satisfiable. We construct a counter-example to $\varphi^\#$.
Again we proceed iteratively. Interpret $A^\epsilon$ such as $A^0$ is interpreted in some satisfying interpretation of $\varphi^Q$. Suppose we are given a sequence $\psi_1\dots \psi_{n-1}$ such that for $i<n$ having $A^i = A^{\psi_0\dots\psi_{n-1}}$ is part of a satisfying interpretation of $\varphi^Q$, in which $X^i_\psi$ is chosen true iff $\psi = \psi_i$. Let $\psi_n\in\mathcal X$. Consider some interpretation of the $A^n$ that are part of a satisfying assignment where $X^n_\psi$ is true iff $\psi = \psi_n$ and all variables quantified above are chosen as before. Have $A^{\psi_0\dots\psi_n} = A^n$ for each propositional variable $A$. From the definitions it directly follows that construction yields a counter-model for $\varphi^\#$.\hfill$\square$
\end{proof}


\end{document}
